<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¦§ç¦§æ‰“å­—ç¶² - XixiTyping</title>
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
<link href="https://fonts.googleapis.com/css2?family=Iansui&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px}
body{font-family:'Iansui','èŠ«è½','Segoe UI','Malgun Gothic','ë§‘ì€ ê³ ë”•',sans-serif;background:#f3f4f6;color:#1f2937;min-height:100vh;display:flex;flex-direction:column}
a{color:#2563eb;text-decoration:none}a:hover{text-decoration:underline}
button{cursor:pointer;border:none;border-radius:6px;padding:8px 18px;font-size:.9rem;font-weight:600;transition:opacity .15s}button:hover{opacity:.85}
input,select,textarea{border:1px solid #d1d5db;border-radius:6px;padding:8px 12px;font-size:.9rem;outline:none;transition:border-color .2s}
input:focus,select:focus,textarea:focus{border-color:#2563eb}
.header{background:#1e293b;color:#f8fafc;padding:12px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.header h1{font-size:1.25rem;font-weight:700;letter-spacing:-.5px;cursor:pointer;user-select:none}.header h1:hover{opacity:.8}.header h1 span{color:#60a5fa}
.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.header-right button{background:#334155;color:#e2e8f0;padding:6px 14px;font-size:.8rem}
.header-right .btn-accent{background:#2563eb;color:#fff}.header-right .user-info{color:#94a3b8;font-size:.85rem}
.tabs{display:flex;background:#e2e8f0;padding:0;border-bottom:2px solid #cbd5e1}
.tab-btn{background:transparent;color:#475569;padding:10px 24px;border-radius:0;font-size:.9rem;border-bottom:3px solid transparent;margin-bottom:-2px}
.tab-btn.active{background:#fff;color:#1e293b;border-bottom-color:#2563eb;font-weight:700}
.main{flex:1;max-width:960px;width:100%;margin:0 auto;padding:20px}
.tab-panel{display:none}.tab-panel.active{display:block}
/* FIX#3: select row + button row always separate */
.practice-select-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px;justify-content:center}
.practice-select-row select{min-width:120px}.practice-select-row #textSelect{min-width:200px}
.practice-btn-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
.btn-start{background:#2563eb;color:#fff}.btn-reset{background:#64748b;color:#fff}.btn-stop{background:#dc2626;color:#fff}
.btn-stop:disabled{opacity:.4;cursor:not-allowed}
.stats-bar{display:flex;gap:16px;flex-wrap:wrap;background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:10px 16px;margin-bottom:16px;font-size:.85rem;justify-content:center;position:sticky;top:0;z-index:40;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.stat-item{display:flex;align-items:center;gap:4px}.stat-label{color:#64748b;font-weight:500}.stat-value{color:#1e293b;font-weight:700;font-variant-numeric:tabular-nums}
.pause-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:100;justify-content:center;align-items:center;font-size:1.4rem;color:#fff;font-weight:700}
.pause-overlay.active{display:flex}
.prep-area{background:#fef9c3;border:2px dashed #d97706;border-radius:8px;padding:10px 16px;margin-bottom:12px;display:flex;align-items:center;gap:12px}
.prep-area .prep-label{color:#92400e;font-size:.9rem;font-weight:600;white-space:nowrap}
.prep-area .prep-input{flex:1;border:1px dashed #d97706;background:#fffef5;border-radius:4px;padding:8px 12px;font-size:1.05rem;font-family:var(--pf)}
.prep-area .prep-input:focus{border-color:#b45309;outline:none}
:root{--pf:'Iansui','èŠ«è½','D2Coding','Noto Sans KR','Consolas','Malgun Gothic',monospace;--pfs:18px;--plh:2;--pls:0.5px;--ppad:10px 14px}
.line-practice-wrapper{position:relative}.line-practice-area{margin-bottom:16px}.line-block{margin-bottom:2px;cursor:text}
.line-original{background:#fffbeb;border:1px solid #e5e7eb;border-bottom:none;border-radius:6px 6px 0 0;padding:var(--ppad);font-size:var(--pfs);line-height:var(--plh);letter-spacing:var(--pls);font-family:var(--pf);white-space:nowrap;overflow:hidden;min-height:28px;color:#6b21a8}
.line-original .ch{color:#6b21a8;transition:color .05s}.line-original .ch.correct{color:#16a34a}
.line-original .ch.incorrect{color:#fff;background:#ef4444;border-radius:2px}.line-original .ch.current{border-bottom:2px solid #2563eb;color:#6b21a8}
.line-original .ch.space-incorrect{background:#fca5a5;border-radius:2px}
.line-block.completed .line-original{background:#d9f99d;border-color:#84cc16}
.line-block.completed .line-input{background:#f0fdf4;border-color:#84cc16;color:#166534}
.line-input{width:100%;display:block;border:2px dashed #d1d5db;border-radius:0 0 6px 6px;padding:var(--ppad);font-size:var(--pfs);line-height:var(--plh);letter-spacing:var(--pls);font-family:var(--pf);outline:none;transition:border-color .2s,background .2s;margin-bottom:6px;background:#fff}
.line-input:focus{border-color:#2563eb;border-style:solid;background:#eff6ff}
/* FIX#6: class-based activation instead of :disabled */
.line-input.inactive-line{background:#f9fafb;color:#9ca3af;border-style:dashed}
.line-input.active-line{border-color:#2563eb;border-style:solid;background:#eff6ff}
.practice-msg{text-align:center;color:#64748b;padding:40px 0;font-size:1rem}
.hotkey-hint{text-align:center;color:#94a3b8;font-size:.8rem;margin-top:8px}
.settings-section{background:#fff;border-radius:8px;padding:20px;border:1px solid #e2e8f0;margin-bottom:16px}
.settings-section h3{font-size:1rem;margin-bottom:12px;color:#1e293b}
.settings-row{display:flex;align-items:center;gap:12px;margin-bottom:10px;flex-wrap:wrap}
.settings-row label{font-size:.9rem;color:#475569;min-width:120px;font-weight:500}
.admin-text-list{max-height:500px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px}
.admin-text-item{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid #f1f5f9;gap:8px}
.admin-text-item:last-child{border-bottom:none}.admin-text-item:hover{background:#f8fafc}
.admin-text-info{flex:1;min-width:0}.admin-text-title{font-weight:600;font-size:.9rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.admin-text-meta{font-size:.75rem;color:#94a3b8}.admin-text-actions{display:flex;gap:6px;flex-shrink:0}
.admin-text-actions button{padding:4px 10px;font-size:.75rem}
.ranking-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
.ranking-table-wrap{background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow-x:auto}
.ranking-table{min-width:100%;width:max-content;border-collapse:collapse;font-size:.85rem}
.ranking-table th{background:#f1f5f9;color:#475569;font-weight:600;padding:10px 12px;text-align:center;border-bottom:2px solid #e2e8f0;border-right:1px dotted #e2e8f0;white-space:nowrap}
.ranking-table th:last-child{border-right:none}
.ranking-table td{padding:8px 12px;border-bottom:1px solid #f1f5f9;border-right:1px dotted #e2e8f0;white-space:nowrap;text-align:right}
.ranking-table td:last-child{border-right:none}
.ranking-table tbody tr:hover{background:#f8fafc}
.ranking-table td.rank-num{color:#2563eb;font-weight:700;text-align:center}
.ranking-table td.rank-date{text-align:center}
.ranking-table td.rank-left{text-align:left}
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.45);z-index:1000;justify-content:center;align-items:center}
.modal-overlay.active{display:flex}
.modal{background:#fff;border-radius:12px;padding:28px;min-width:340px;max-width:560px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.25);max-height:90vh;overflow-y:auto}
.modal h2{font-size:1.15rem;margin-bottom:18px;color:#1e293b}
.modal-field{margin-bottom:14px}.modal-field label{display:block;font-size:.85rem;color:#475569;margin-bottom:4px;font-weight:500}
.modal-field input,.modal-field select,.modal-field textarea{width:100%}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
.btn-primary{background:#2563eb;color:#fff}.btn-secondary{background:#e2e8f0;color:#475569}.btn-danger{background:#dc2626;color:#fff}
.modal-msg{color:#dc2626;font-size:.85rem;margin-top:8px;min-height:20px}.modal-msg.success{color:#16a34a}
.results-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0}
.result-card{background:#f8fafc;border-radius:8px;padding:14px;text-align:center}
.result-card .r-label{font-size:.8rem;color:#64748b;margin-bottom:4px}
.result-card .r-value{font-size:1.4rem;font-weight:700;color:#1e293b}.result-card .r-value.highlight{color:#2563eb}
.footer{text-align:center;padding:16px;color:#94a3b8;font-size:.8rem;border-top:1px solid #e2e8f0}
.scroll-btn{position:fixed;right:12px;z-index:50;width:40px;height:40px;border-radius:50%;background:#334155;color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.2rem;box-shadow:0 2px 8px rgba(0,0,0,.2);opacity:.6;transition:opacity .2s}
.scroll-btn:hover{opacity:1}
.scroll-btn.up{bottom:68px}.scroll-btn.down{bottom:20px}
.admin-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
.admin-controls select{min-width:100px}
.admin-count{font-size:.85rem;color:#475569;font-weight:500}
/* FIX#4: pending-item stacked layout for comment input */
.pending-item{display:flex;flex-direction:column;padding:10px 14px;border-bottom:1px solid #f1f5f9;gap:6px}
.pending-item:last-child{border-bottom:none}.pending-item:hover{background:#f8fafc}
/* FIX#5: notification banner */
.notif-banner{background:#fef3c7;border:1px solid #fcd34d;border-radius:8px;padding:12px 16px;margin-bottom:12px;font-size:.88rem;color:#92400e;position:relative}
.notif-banner .notif-close{position:absolute;top:8px;right:12px;cursor:pointer;font-weight:700;color:#b45309;font-size:1rem;background:none;border:none;padding:0}
.notif-banner .notif-title{font-weight:700;margin-bottom:2px}
@media(max-width:600px){.header{padding:10px 14px}.main{padding:12px}.stats-bar{gap:8px;padding:8px 10px;font-size:.78rem}.tab-btn{padding:8px 14px;font-size:.8rem}.prep-area{flex-direction:column;gap:6px}}
</style>
</head>
<body>
<div class="header"><h1 onclick="location.reload()"><span>ç¦§ç¦§</span>æ‰“å­—ç¶²</h1>
<div class="header-right"><span class="user-info" id="userInfo">ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ</span>
<button id="btnLogin" class="btn-accent" onclick="showLoginModal()">ë¡œê·¸ì¸</button>
<button id="btnSignup" onclick="showSignupModal()">íšŒì›ê°€ì…</button>
<button id="btnLogout" style="display:none" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button></div></div>

<div class="tabs" id="tabBar">
<button class="tab-btn active" data-tab="practice">ì—°ìŠµ</button>
<button class="tab-btn" data-tab="settings">ì„¤ì •</button>
<button class="tab-btn" data-tab="ranking">ë­í‚¹</button>
<button class="tab-btn" data-tab="account">ê³„ì •</button>
<button class="tab-btn" data-tab="admin" id="tabAdmin" style="display:none">ê´€ë¦¬</button>
</div>

<div class="main">
<!-- FIX#5: notification area at top -->
<div id="notifArea"></div>

<!-- Practice -->
<div class="tab-panel active" id="panel-practice">
<!-- FIX#3: selects and buttons on separate rows -->
<div class="practice-select-row">
<select id="langSelect"><option value="">ì „ì²´</option></select>
<select id="textSelect"><option value="">í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</option></select>
</div>
<div class="practice-btn-row">
<button class="btn-reset" onclick="doReset()">ì´ˆê¸°í™” (F11)</button>
<button class="btn-stop" disabled data-state="stop" onclick="if(practicing){stopPractice();}else if(this.dataset.state==='result'){openModal('resultsModal');}">ì—°ìŠµ ì¢…ë£Œ (F12)</button>
</div>
<div class="stats-bar" id="statsBar" style="display:none">
<div class="stat-item"><span class="stat-label">ì‹œê°„</span><span class="stat-value" id="statTime">0:00</span></div>
<div class="stat-item"><span class="stat-label">CPM</span><span class="stat-value" id="statCpm">0</span></div>
<div class="stat-item"><span class="stat-label">íƒ€ìˆ˜(KPM)</span><span class="stat-value" id="statKpm">0</span></div>
<div class="stat-item"><span class="stat-label">ì •í™•ë„</span><span class="stat-value" id="statAcc">0%</span></div>
<div class="stat-item"><span class="stat-label">ì§„í–‰ë¥ </span><span class="stat-value" id="statProgress">0%</span></div>
<div class="stat-item"><span class="stat-label">ì…ë ¥ê¸€ì</span><span class="stat-value" id="statChars">0</span></div>
<div class="stat-item"><span class="stat-label">ì´íƒ€ìˆ˜</span><span class="stat-value" id="statKeys">0</span></div>
<div class="stat-item" id="pauseStatus" style="display:none"><span class="stat-value" style="color:#dc2626">â¸ ì¼ì‹œì •ì§€</span></div>
</div>
<div id="practiceArea" style="display:none">
<div class="prep-area" id="prepArea"><span class="prep-label">æº–å‚™å€ï¼š</span><input class="prep-input" id="prepInput" placeholder="åœ¨é€™è£¡èª¿æ•´è¼¸å…¥æ³•ï¼ŒæŒ‰ Enter/â†“ é–‹å§‹è¨ˆæ™‚"></div>
<div class="line-practice-wrapper"><div class="line-practice-area" id="linePracticeArea"></div></div>
<div class="hotkey-hint">Enter/Space(í–‰ë): ë‹¤ìŒ í–‰ | Tab/Shift+Tab/â†‘â†“: í–‰ ì´ë™ | BackSpace(í–‰ì•): ì´ì „ í–‰ | ESC: ì¼ì‹œì •ì§€</div>
</div>
<div class="practice-msg" id="practiceMsg">ìœ„ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  <strong>ì‹œì‘</strong>ì„ ëˆ„ë¥´ì„¸ìš”.</div>
</div>

<!-- Settings -->
<div class="tab-panel" id="panel-settings">
<div class="settings-section"><h3 id="uiLangLabel">UI ì–¸ì–´</h3>
<div class="settings-row"><label>Language</label>
<select id="settingUILang" onchange="setWebLang(this.value)"><option value="ko">í•œêµ­ì–´</option><option value="zh">ä¸­æ–‡</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option></select></div></div>
<div class="settings-section"><h3>ì—°ìŠµ ë‹¨ìœ„</h3>
<div class="settings-row"><label>í‘œì‹œ í˜•ì‹</label>
<select id="settingUnitMode"><option value="line">í–‰ ë‹¨ìœ„ (ì¤„ë§ˆë‹¤ ë¶„í• )</option><option value="paragraph">ë¬¸ë‹¨ ë‹¨ìœ„ (ì›ë³¸ ì¤„ë°”ê¿ˆ ìœ ì§€)</option></select></div>
<p style="font-size:.8rem;color:#94a3b8;margin-top:4px">â€» 'í–‰ ë‹¨ìœ„'ëŠ” ê¸´ ë¬¸ë‹¨ì„ ì°½ ë„ˆë¹„ì— ë§ê²Œ ì—¬ëŸ¬ ì¤„ë¡œ ë¶„í• í•©ë‹ˆë‹¤.</p></div>
<div class="settings-section"><h3>í°íŠ¸ í¬ê¸°</h3>
<div class="settings-row"><label>ì›ë¬¸/ì…ë ¥</label><input type="number" id="settingFontSize" value="18" min="12" max="40" step="1" style="width:80px"><span style="font-size:.85rem;color:#94a3b8">px</span></div></div>
<div class="settings-section"><h3>ì¤„ ê°„ê²©</h3>
<div class="settings-row"><label>line-height</label><input type="number" id="settingLineHeight" value="2" min="1.2" max="3" step="0.1" style="width:80px"></div></div>
<div class="settings-section"><h3>ìê°„</h3>
<div class="settings-row"><label>letter-spacing</label><input type="number" id="settingLetterSpacing" value="0.5" min="0" max="5" step="0.1" style="width:80px"><span style="font-size:.85rem;color:#94a3b8">px</span></div></div>
<div class="settings-section"><h3>í‚¤ ì…ë ¥ íš¨ê³¼ìŒ</h3>
<div class="settings-row"><label>íš¨ê³¼ìŒ</label>
<select id="settingSfxEnabled"><option value="on">ì¼œê¸°</option><option value="off">ë„ê¸°</option></select></div>
<div class="settings-row"><label>íš¨ê³¼ìŒ ì¢…ë¥˜</label>
<select id="settingSfxStyle"><option value="typewriter">ì „í†µ íƒ€ìê¸°</option><option value="retro">ë ˆíŠ¸ë¡œ</option><option value="analog">ì•„ë‚ ë¡œê·¸</option><option value="mechanical">ê¸°ê³„ìŒ</option><option value="soft">ì†Œí”„íŠ¸</option></select></div>
<div class="settings-row"><label>ìŒëŸ‰</label><input type="range" id="settingSfxVolume" min="0" max="100" value="50" style="width:160px"><span id="sfxVolLabel" style="font-size:.85rem;color:#94a3b8;min-width:35px">50%</span></div>
</div>
<div class="settings-section"><h3>ë” ë§ì€ íƒ€ì ì—°ìŠµ í…ìŠ¤íŠ¸ ì‹ ì²­</h3>
<p style="font-size:.85rem;color:#64748b;margin-bottom:12px">ìƒˆ í…ìŠ¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì‹¶ë‹¤ë©´ .txt íŒŒì¼ì„ ì„ íƒí•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë“±ë¡ë©ë‹ˆë‹¤.</p>
<div id="textRequestLogin" style="display:none"><p style="color:#dc2626;font-size:.85rem">ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div>
<div id="textRequestForm" style="display:none">
<div class="settings-row"><label>í…ìŠ¤íŠ¸ íŒŒì¼</label><div style="display:flex;align-items:center;gap:8px"><button type="button" class="btn-secondary" id="reqFileBtn" onclick="document.getElementById('reqTextFile').click()" style="padding:4px 12px;font-size:.85rem">íŒŒì¼ ì„ íƒ</button><span id="reqFileName" style="font-size:.85rem;color:#94a3b8">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span><input type="file" id="reqTextFile" accept=".txt" style="display:none" onchange="document.getElementById('reqFileName').textContent=this.files[0]?this.files[0].name:wt('no_file_chosen')"></div></div>
<div class="settings-row"><label>ì–¸ì–´</label><select id="reqTextLang"><option value="í•œêµ­ì–´">í•œêµ­ì–´</option><option value="ä¸­æ–‡">ì¤‘êµ­ì–´</option><option value="ì˜ì–´">ì˜ì–´</option><option value="æ—¥æœ¬èª">ì¼ë³¸ì–´</option></select></div>
<button class="btn-primary" onclick="submitTextRequest()" style="font-size:.85rem;padding:6px 14px">ì‹ ì²­í•˜ê¸°</button>
<div class="modal-msg" id="reqTextMsg"></div>
</div></div>
<div class="settings-section" id="pendingRequestsSection" style="display:none">
<h3>ìŠ¹ì¸ ëŒ€ê¸° í…ìŠ¤íŠ¸ ëª©ë¡</h3>
<button class="btn-secondary" onclick="loadPendingRequests()" style="margin-bottom:10px;font-size:.85rem;padding:5px 12px">ìƒˆë¡œê³ ì¹¨</button>
<div id="pendingRequestsList" style="max-height:400px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:6px"><div style="padding:20px;text-align:center;color:#94a3b8">ë¡œë”© ì¤‘...</div></div>
</div></div>

<!-- Ranking -->
<div class="tab-panel" id="panel-ranking">
<div class="ranking-controls"><select id="rankBoardSelect"><option value="">ì „ì²´</option></select>
<button class="btn-primary" onclick="loadRankings()" style="padding:6px 14px;font-size:.85rem">ìƒˆë¡œê³ ì¹¨</button></div>
<div class="ranking-table-wrap"><table class="ranking-table">
<thead><tr><th style="min-width:50px">ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>íƒ€ìê¸°</th><th>í…ìŠ¤íŠ¸</th><th>CPM</th><th>KPM</th><th>ì •í™•ë„</th><th>ì™„ë£Œìœ¨</th><th>ì´ ì…ë ¥</th><th>ê¸°ë¡ì¼</th></tr></thead>
<tbody id="rankBody"><tr><td colspan="10" style="text-align:center;padding:30px;color:#94a3b8">ë¡œë”© ì¤‘...</td></tr></tbody>
</table></div>
<div id="rankAdminPanel" style="display:none;margin-top:12px;padding:12px;background:#fef3c7;border:1px solid #fbbf24;border-radius:8px">
<div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
<strong style="font-size:.9rem">ğŸ”§ ê´€ë¦¬ì ë­í‚¹ í¸ì§‘</strong>
<button class="btn-secondary" onclick="rankAdminSelectAll(true)" style="padding:4px 10px;font-size:.8rem">ì „ì²´ ì„ íƒ</button>
<button class="btn-secondary" onclick="rankAdminSelectAll(false)" style="padding:4px 10px;font-size:.8rem">ì „ì²´ í•´ì œ</button>
<button class="btn-danger" onclick="rankAdminDeleteSelected()" style="padding:4px 10px;font-size:.8rem">ì„ íƒ ì‚­ì œ</button>
<button class="btn-danger" onclick="rankAdminDeleteBoard()" style="padding:4px 10px;font-size:.8rem">í˜„ì¬ ë³´ë“œ ì „ì²´ ì‚­ì œ</button>
<span id="rankAdminSelCount" style="font-size:.8rem;color:#92400e"></span>
</div></div></div>

<!-- Account -->
<div class="tab-panel" id="panel-account">
<div id="accountLoggedOut"><div class="practice-msg"><span id="acctLoginMsg">ë¡œê·¸ì¸í•˜ë©´ ë­í‚¹ ë“±ë¡ ë“±ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span><br><br>
<button class="btn-primary" id="acctBtnLogin" onclick="showLoginModal()">ë¡œê·¸ì¸</button> <button class="btn-secondary" id="acctBtnSignup" onclick="showSignupModal()">íšŒì›ê°€ì…</button></div></div>
<div id="accountLoggedIn" style="display:none"><div style="background:#fff;border-radius:8px;padding:24px;border:1px solid #e2e8f0">
<h3 id="acctInfoTitle" style="margin-bottom:16px">ê³„ì • ì •ë³´</h3>
<p style="margin-bottom:8px"><strong>ID:</strong> <span id="acctId">-</span></p>
<p style="margin-bottom:20px"><strong id="acctNickLabel">ë‹‰ë„¤ì„:</strong> <span id="acctNick">-</span></p>
<div style="display:flex;gap:10px;flex-wrap:wrap">
<button class="btn-secondary" id="acctBtnFindId" onclick="showFindIdModal()">ì•„ì´ë”” ì°¾ê¸°</button>
<button class="btn-secondary" id="acctBtnResetPw" onclick="showResetPwModal()">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</button>
<button class="btn-danger" id="acctBtnWithdraw" onclick="showDeleteAccountModal()">íšŒì›íƒˆí‡´</button></div></div></div></div>

<!-- Admin -->
<div class="tab-panel" id="panel-admin">
<div class="settings-section"><h3 id="adminMgmtTitle">ì„œë²„ í…ìŠ¤íŠ¸ ê´€ë¦¬ <span class="admin-count" id="adminTotalCount"></span></h3>
<div class="admin-controls">
<button class="btn-primary" id="adminBtnAdd" onclick="showAddTextModal()">ìƒˆ í…ìŠ¤íŠ¸ ì¶”ê°€</button>
<button class="btn-secondary" id="adminBtnRefresh" onclick="refreshAdminTextList()">ìƒˆë¡œê³ ì¹¨</button>
<select id="adminLangFilter"><option value="">ì „ì²´</option></select>
<button class="btn-secondary" id="adminBtnSelAll" onclick="adminSelectAll(true)" style="padding:5px 10px;font-size:.8rem">ì „ì²´ ì„ íƒ</button>
<button class="btn-secondary" id="adminBtnDeselAll" onclick="adminSelectAll(false)" style="padding:5px 10px;font-size:.8rem">ì „ì²´ í•´ì œ</button>
<button class="btn-danger" id="adminBtnDelSel" onclick="adminDeleteSelected()" style="padding:5px 10px;font-size:.8rem">ì„ íƒ ì‚­ì œ</button>
<span class="admin-count" id="adminSelCount"></span>
</div>
<div class="admin-text-list" id="adminTextList"><div style="padding:20px;text-align:center;color:#94a3b8">ë¡œë”© ì¤‘...</div></div></div></div>
</div>

<div class="footer">ç¦§ç¦§æ‰“å­—ç¶² (XixiTyping) â€” <span id="footerWebVer">ì›¹ ë²„ì „</span></div>
<button class="scroll-btn up" onmousedown="event.preventDefault();window.scrollTo({top:0,behavior:'smooth'})" id="scrollTopBtn" title="ë§¨ ìœ„ë¡œ">â–²</button>
<button class="scroll-btn down" onmousedown="event.preventDefault();window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'})" id="scrollBottomBtn" title="ë§¨ ì•„ë˜ë¡œ">â–¼</button>

<!-- Modals -->
<div class="modal-overlay" id="loginModal"><div class="modal"><h2>ë¡œê·¸ì¸</h2>
<div class="modal-field"><label id="loginIdLabel">ID</label><input id="loginId" autocomplete="username"></div>
<div class="modal-field"><label id="loginPwLabel">ë¹„ë°€ë²ˆí˜¸</label><input id="loginPw" type="password" autocomplete="current-password"></div>
<div class="modal-msg" id="loginMsg"></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('loginModal')" id="loginBtnCancel">ì·¨ì†Œ</button><button class="btn-primary" onclick="doLogin()" id="loginBtnSubmit">ë¡œê·¸ì¸</button></div></div></div>

<div class="modal-overlay" id="signupModal"><div class="modal"><h2>íšŒì›ê°€ì…</h2>
<div class="modal-field"><label>ID (3ì ì´ìƒ)</label><input id="signupId" autocomplete="username"></div>
<div class="modal-field"><label>ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)</label><input id="signupPw" type="password" autocomplete="new-password"></div>
<div class="modal-field"><label>ë‹‰ë„¤ì„ (10ì ì´í•˜)</label><input id="signupNick"></div>
<div class="modal-field"><label>ì´ë©”ì¼</label><input id="signupEmail" type="email"></div>
<div class="modal-msg" id="signupMsg"></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('signupModal')">ì·¨ì†Œ</button><button class="btn-primary" onclick="doSignup()">ê°€ì…</button></div></div></div>

<div class="modal-overlay" id="resultsModal"><div class="modal"><h2>ì—°ìŠµ ê²°ê³¼</h2>
<div class="results-grid">
<div class="result-card"><div class="r-label" id="resCpmLabel">CPM (íƒ€/ë¶„)</div><div class="r-value highlight" id="resCpm">0</div></div>
<div class="result-card"><div class="r-label" id="resKpmLabel">íƒ€ìˆ˜ (KPM)</div><div class="r-value" id="resKpm">0</div></div>
<div class="result-card"><div class="r-label" id="resAccLabel">ì •í™•ë„</div><div class="r-value" id="resAcc">0%</div></div>
<div class="result-card"><div class="r-label" id="resProgressLabel">ì§„í–‰ë¥ </div><div class="r-value" id="resProgress">0%</div></div>
<div class="result-card"><div class="r-label" id="resTimeLabel">ì†Œìš” ì‹œê°„</div><div class="r-value" id="resTime">0ì´ˆ</div></div>
<div class="result-card"><div class="r-label" id="resCharsLabel">ì´ ê¸€ì</div><div class="r-value" id="resChars">0</div></div></div>
<div id="rankSubmitArea" style="display:none">
<div class="modal-field"><label id="resTypewriterLabel">íƒ€ìê¸° êµ¬ë¶„</label><input id="resTypewriter" placeholder="ì˜ˆ) í•œê¸€ ë‘ë²Œì‹, å€‰é ¡, å˜¸è¦ç±³"></div>
<button class="btn-primary" onclick="submitRanking()" style="margin-top:8px;width:100%" id="btnSubmitRank">ë­í‚¹ì— ë“±ë¡</button>
<div class="modal-msg" id="rankSubmitMsg"></div></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('resultsModal')" id="btnResultClose">ë‹«ê¸°</button></div></div></div>

<div class="modal-overlay" id="findIdModal"><div class="modal"><h2>ì•„ì´ë”” ì°¾ê¸°</h2>
<div class="modal-field"><label id="findIdEmailLabel">ì´ë©”ì¼</label><input id="findIdEmail" type="email"></div>
<div class="modal-msg" id="findIdMsg"></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('findIdModal')" id="findIdBtnClose">ë‹«ê¸°</button><button class="btn-primary" onclick="doFindId()" id="findIdBtnFind">ì°¾ê¸°</button></div></div></div>

<div class="modal-overlay" id="resetPwModal"><div class="modal"><h2 id="resetPwTitle">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h2>
<div class="modal-field"><label>ID</label><input id="resetPwId"></div>
<div class="modal-field"><label id="resetPwEmailLabel">ì´ë©”ì¼</label><input id="resetPwEmail" type="email"></div>
<div class="modal-field"><label id="resetPwNewLabel">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label><input id="resetPwNew" type="password"></div>
<div class="modal-field"><label id="resetPwConfirmLabel">í™•ì¸</label><input id="resetPwConfirm" type="password"></div>
<div class="modal-msg" id="resetPwMsg"></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('resetPwModal')" id="resetPwBtnClose">ë‹«ê¸°</button><button class="btn-primary" onclick="doResetPw()" id="resetPwBtnReset">ì¬ì„¤ì •</button></div></div></div>

<div class="modal-overlay" id="deleteAccountModal"><div class="modal"><h2>íšŒì›íƒˆí‡´</h2>
<p style="color:#dc2626;font-weight:600;margin-bottom:16px">ê³„ì •ê³¼ ë­í‚¹ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.</p>
<div class="modal-field"><label>ë¹„ë°€ë²ˆí˜¸</label><input id="delAcctPw" type="password"></div>
<div class="modal-field"><label>'íƒˆí‡´' ì…ë ¥</label><input id="delAcctConfirm"></div>
<div class="modal-msg" id="delAcctMsg"></div>
<div class="modal-actions"><button class="btn-secondary" onclick="closeModal('deleteAccountModal')" id="delAcctBtnCancel">ì·¨ì†Œ</button><button class="btn-danger" onclick="doDeleteAccount()" id="delAcctBtnDelete">íƒˆí‡´</button></div></div></div>

<div class="modal-overlay" id="editTextModal"><div class="modal" style="max-width:640px"><h2 id="editTextTitle">í…ìŠ¤íŠ¸ í¸ì§‘</h2>
<input type="hidden" id="editTextId">
<div class="modal-field"><label id="editTextNameLabel">ì œëª©</label><input id="editTextName"></div>
<div class="modal-field"><label id="editTextLangLabel">ì–¸ì–´</label><select id="editTextLang"><option value="í•œêµ­ì–´">í•œêµ­ì–´</option><option value="ä¸­æ–‡">ì¤‘êµ­ì–´</option><option value="ì˜ì–´">ì˜ì–´</option><option value="æ—¥æœ¬èª">ì¼ë³¸ì–´</option></select></div>
<div class="modal-field"><label>ë‚´ìš©</label><textarea id="editTextContent" rows="12" style="font-family:var(--pf);font-size:.85rem;line-height:1.6"></textarea></div>
<div class="modal-msg" id="editTextMsg"></div>
<div class="modal-actions">
<button class="btn-danger" id="btnDeleteText" onclick="doDeleteText()" style="margin-right:auto">ì‚­ì œ</button>
<button class="btn-secondary" onclick="closeModal('editTextModal')" id="editBtnCancel">ì·¨ì†Œ</button>
<button class="btn-primary" onclick="doSaveText()" id="editBtnSave">ì €ì¥</button></div></div></div>

<div class="pause-overlay" id="pauseOverlay">â¸ ì¼ì‹œì •ì§€ â€” ì•„ë¬´ í‚¤ë¥¼ ëˆ„ë¥´ê±°ë‚˜ í´ë¦­í•˜ë©´ ì¬ê°œ</div>

<script>
const API='',ADMIN_ID='zhengxi980';
// â”€â”€ UI ë‹¤êµ­ì–´ â”€â”€
const WLANG={
tab_practice:{ko:'ì—°ìŠµ',zh:'ç·´ç¿’',en:'Practice',ja:'ç·´ç¿’'},
tab_settings:{ko:'ì„¤ì •',zh:'è¨­å®š',en:'Settings',ja:'è¨­å®š'},
tab_ranking:{ko:'ë­í‚¹',zh:'æ’è¡Œæ¦œ',en:'Ranking',ja:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°'},
tab_account:{ko:'ê³„ì •',zh:'å¸³è™Ÿ',en:'Account',ja:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ'},
tab_admin:{ko:'ê´€ë¦¬',zh:'ç®¡ç†',en:'Admin',ja:'ç®¡ç†'},
btn_login:{ko:'ë¡œê·¸ì¸',zh:'ç™»å…¥',en:'Login',ja:'ãƒ­ã‚°ã‚¤ãƒ³'},
btn_signup:{ko:'íšŒì›ê°€ì…',zh:'è¨»å†Š',en:'Sign Up',ja:'æ–°è¦ç™»éŒ²'},
btn_logout:{ko:'ë¡œê·¸ì•„ì›ƒ',zh:'ç™»å‡º',en:'Logout',ja:'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ'},
not_logged_in:{ko:'ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ',zh:'æœªç™»å…¥',en:'Not logged in',ja:'æœªãƒ­ã‚°ã‚¤ãƒ³'},
all:{ko:'ì „ì²´',zh:'å…¨éƒ¨',en:'All',ja:'ã™ã¹ã¦'},
select_text:{ko:'í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”',zh:'è«‹é¸æ“‡æ–‡æœ¬',en:'Select a text',ja:'ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„'},
btn_reset_f11:{ko:'ì´ˆê¸°í™” (F11)',zh:'é‡ç½® (F11)',en:'Reset (F11)',ja:'ãƒªã‚»ãƒƒãƒˆ (F11)'},
btn_stop_f12:{ko:'ì—°ìŠµ ì¢…ë£Œ (F12)',zh:'çµæŸç·´ç¿’ (F12)',en:'End Practice (F12)',ja:'ç·´ç¿’çµ‚äº† (F12)'},
btn_result_f12:{ko:'ê²°ê³¼ í™•ì¸ (F12)',zh:'æŸ¥çœ‹çµæœ (F12)',en:'View Results (F12)',ja:'çµæœç¢ºèª (F12)'},
stat_time:{ko:'ì‹œê°„',zh:'æ™‚é–“',en:'Time',ja:'æ™‚é–“'},
stat_cpm:{ko:'CPM',zh:'CPM',en:'CPM',ja:'CPM'},
stat_kpm:{ko:'íƒ€ìˆ˜(KPM)',zh:'æ“Šéµ(KPM)',en:'KPM',ja:'æ‰“éµ(KPM)'},
stat_acc:{ko:'ì •í™•ë„',zh:'æ­£ç¢ºç‡',en:'Accuracy',ja:'æ­£ç¢ºç‡'},
stat_progress:{ko:'ì§„í–‰ë¥ ',zh:'é€²åº¦',en:'Progress',ja:'é€²è¡Œç‡'},
stat_chars:{ko:'ì…ë ¥ê¸€ì',zh:'è¼¸å…¥å­—æ•¸',en:'Input Chars',ja:'å…¥åŠ›æ–‡å­—'},
stat_keys:{ko:'ì´íƒ€ìˆ˜',zh:'ç¸½æ“Šéµ',en:'Keystrokes',ja:'ç·æ‰“éµ'},
pause:{ko:'â¸ ì¼ì‹œì •ì§€',zh:'â¸ æš«åœ',en:'â¸ Paused',ja:'â¸ ä¸€æ™‚åœæ­¢'},
pause_overlay:{ko:'â¸ ì¼ì‹œì •ì§€ â€” ì•„ë¬´ í‚¤ë¥¼ ëˆ„ë¥´ê±°ë‚˜ í´ë¦­í•˜ë©´ ì¬ê°œ',zh:'â¸ æš«åœ â€” æŒ‰ä»»æ„éµæˆ–é»æ“Šä»¥ç¹¼çºŒ',en:'â¸ Paused â€” Press any key or click to resume',ja:'â¸ ä¸€æ™‚åœæ­¢ â€” ä»»æ„ã®ã‚­ãƒ¼ã‚’æŠ¼ã™ã‹ã‚¯ãƒªãƒƒã‚¯ã§å†é–‹'},
hotkey_hint:{ko:'Enter/Space(í–‰ë): ë‹¤ìŒ í–‰ | Tab/Shift+Tab/â†‘â†“: í–‰ ì´ë™ | BackSpace(í–‰ì•): ì´ì „ í–‰ | ESC: ì¼ì‹œì •ì§€',zh:'Enter/Space(è¡Œæœ«): ä¸‹ä¸€è¡Œ | Tab/Shift+Tab/â†‘â†“: åˆ‡æ›è¡Œ | BackSpace(è¡Œé¦–): ä¸Šä¸€è¡Œ | ESC: æš«åœ',en:'Enter/Space(end): Next line | Tab/Shift+Tab/â†‘â†“: Move line | BackSpace(start): Prev line | ESC: Pause',ja:'Enter/Space(è¡Œæœ«): æ¬¡ã®è¡Œ | Tab/Shift+Tab/â†‘â†“: è¡Œç§»å‹• | BackSpace(è¡Œé ­): å‰ã®è¡Œ | ESC: ä¸€æ™‚åœæ­¢'},
practice_msg:{ko:'ìœ„ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  <strong>ì‹œì‘</strong>ì„ ëˆ„ë¥´ì„¸ìš”.',zh:'è«‹åœ¨ä¸Šæ–¹é¸æ“‡æ–‡æœ¬ï¼Œç„¶å¾ŒæŒ‰<strong>é–‹å§‹</strong>ã€‚',en:'Select a text above and press <strong>Start</strong>.',ja:'ä¸Šã§ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã€<strong>é–‹å§‹</strong>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚'},
prep_label:{ko:'æº–å‚™å€ï¼š',zh:'æº–å‚™å€ï¼š',en:'Prep:',ja:'æº–å‚™ï¼š'},
prep_placeholder:{ko:'åœ¨é€™è£¡èª¿æ•´è¼¸å…¥æ³•ï¼ŒæŒ‰ Enter/â†“ é–‹å§‹è¨ˆæ™‚',zh:'åœ¨é€™è£¡èª¿æ•´è¼¸å…¥æ³•ï¼ŒæŒ‰ Enter/â†“ é–‹å§‹è¨ˆæ™‚',en:'Adjust input method here, press Enter/â†“ to start',ja:'ã“ã“ã§å…¥åŠ›æ–¹å¼ã‚’èª¿æ•´ã—ã€Enter/â†“ã§é–‹å§‹'},
settings_unit:{ko:'ì—°ìŠµ ë‹¨ìœ„',zh:'ç·´ç¿’å–®ä½',en:'Practice Unit',ja:'ç·´ç¿’å˜ä½'},
settings_unit_label:{ko:'í‘œì‹œ í˜•ì‹',zh:'é¡¯ç¤ºæ ¼å¼',en:'Display Mode',ja:'è¡¨ç¤ºå½¢å¼'},
unit_line:{ko:'í–‰ ë‹¨ìœ„ (ì¤„ë§ˆë‹¤ ë¶„í• )',zh:'è¡Œæ¨¡å¼ï¼ˆé€è¡Œåˆ†å‰²ï¼‰',en:'Line mode (split per line)',ja:'è¡Œå˜ä½ï¼ˆè¡Œã”ã¨ã«åˆ†å‰²ï¼‰'},
unit_para:{ko:'ë¬¸ë‹¨ ë‹¨ìœ„ (ì›ë³¸ ì¤„ë°”ê¿ˆ ìœ ì§€)',zh:'æ®µè½æ¨¡å¼ï¼ˆä¿ç•™åŸå§‹æ›è¡Œï¼‰',en:'Paragraph mode (keep original)',ja:'æ®µè½å˜ä½ï¼ˆå…ƒã®æ”¹è¡Œã‚’ä¿æŒï¼‰'},
unit_note:{ko:"â€» 'í–‰ ë‹¨ìœ„'ëŠ” ê¸´ ë¬¸ë‹¨ì„ ì°½ ë„ˆë¹„ì— ë§ê²Œ ì—¬ëŸ¬ ì¤„ë¡œ ë¶„í• í•©ë‹ˆë‹¤.",zh:'â€»ã€Œè¡Œæ¨¡å¼ã€æœƒå°‡é•·æ®µè½ä¾è¦–çª—å¯¬åº¦åˆ†å‰²ç‚ºå¤šè¡Œã€‚',en:"â€» 'Line mode' splits long paragraphs by window width.",ja:'â€»ã€Œè¡Œå˜ä½ã€ã§ã¯é•·ã„æ®µè½ã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ã«åˆã‚ã›ã¦è¤‡æ•°è¡Œã«åˆ†å‰²ã—ã¾ã™ã€‚'},
settings_font_size:{ko:'í°íŠ¸ í¬ê¸°',zh:'å­—å‹å¤§å°',en:'Font Size',ja:'ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º'},
lbl_original_input:{ko:'ì›ë¬¸/ì…ë ¥',zh:'åŸæ–‡/è¼¸å…¥',en:'Original/Input',ja:'åŸæ–‡/å…¥åŠ›'},
settings_line_height:{ko:'ì¤„ ê°„ê²©',zh:'è¡Œè·',en:'Line Height',ja:'è¡Œé–“éš”'},
settings_letter_spacing:{ko:'ìê°„',zh:'å­—è·',en:'Letter Spacing',ja:'å­—é–“'},
settings_sfx:{ko:'í‚¤ ì…ë ¥ íš¨ê³¼ìŒ',zh:'æŒ‰éµéŸ³æ•ˆ',en:'Key Sound Effects',ja:'ã‚­ãƒ¼å…¥åŠ›åŠ¹æœéŸ³'},
lbl_sfx:{ko:'íš¨ê³¼ìŒ',zh:'éŸ³æ•ˆ',en:'Sound',ja:'åŠ¹æœéŸ³'},
sfx_on:{ko:'ì¼œê¸°',zh:'é–‹',en:'On',ja:'ã‚ªãƒ³'},
sfx_off:{ko:'ë„ê¸°',zh:'é—œ',en:'Off',ja:'ã‚ªãƒ•'},
lbl_sfx_type:{ko:'íš¨ê³¼ìŒ ì¢…ë¥˜',zh:'éŸ³æ•ˆé¡å‹',en:'Sound Type',ja:'åŠ¹æœéŸ³ã®ç¨®é¡'},
sfx_typewriter:{ko:'ì „í†µ íƒ€ìê¸°',zh:'å‚³çµ±æ‰“å­—æ©Ÿ',en:'Typewriter',ja:'ã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼'},
sfx_retro:{ko:'ë ˆíŠ¸ë¡œ',zh:'å¾©å¤',en:'Retro',ja:'ãƒ¬ãƒˆãƒ­'},
sfx_analog:{ko:'ì•„ë‚ ë¡œê·¸',zh:'é¡æ¯”',en:'Analog',ja:'ã‚¢ãƒŠãƒ­ã‚°'},
sfx_mechanical:{ko:'ê¸°ê³„ìŒ',zh:'æ©Ÿæ¢°',en:'Mechanical',ja:'ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«'},
sfx_soft:{ko:'ì†Œí”„íŠ¸',zh:'è¼•æŸ”',en:'Soft',ja:'ã‚½ãƒ•ãƒˆ'},
lbl_volume:{ko:'ìŒëŸ‰',zh:'éŸ³é‡',en:'Volume',ja:'éŸ³é‡'},
settings_text_request:{ko:'ë” ë§ì€ íƒ€ì ì—°ìŠµ í…ìŠ¤íŠ¸ ì‹ ì²­',zh:'ç”³è«‹æ›´å¤šæ‰“å­—ç·´ç¿’æ–‡æœ¬',en:'Request More Practice Texts',ja:'ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ãƒ†ã‚­ã‚¹ãƒˆã®è¿½åŠ ç”³è«‹'},
text_req_desc:{ko:'ìƒˆ í…ìŠ¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì‹¶ë‹¤ë©´ .txt íŒŒì¼ì„ ì„ íƒí•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë“±ë¡ë©ë‹ˆë‹¤.',zh:'è‹¥è¦æ–°å¢æ–‡æœ¬ï¼Œè«‹é¸æ“‡ .txt æª”æ¡ˆä¸Šå‚³ã€‚ç¶“ç®¡ç†å“¡å¯©æ ¸å¾Œå³å¯ä½¿ç”¨ã€‚',en:'To add new text, select and upload a .txt file. Available after admin approval.',ja:'æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’ç™»éŒ²ã—ãŸã„å ´åˆã¯ã€.txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚ç®¡ç†è€…ã®æ‰¿èªå¾Œã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚'},
text_req_login:{ko:'ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',zh:'è«‹å…ˆç™»å…¥ã€‚',en:'Please log in first.',ja:'ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«åˆ©ç”¨ã§ãã¾ã™ã€‚'},
lbl_text_file:{ko:'í…ìŠ¤íŠ¸ íŒŒì¼',zh:'æ–‡æœ¬æª”æ¡ˆ',en:'Text File',ja:'ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«'},
lbl_lang:{ko:'ì–¸ì–´',zh:'èªè¨€',en:'Language',ja:'è¨€èª'},
btn_submit:{ko:'ì‹ ì²­í•˜ê¸°',zh:'æäº¤',en:'Submit',ja:'é€ä¿¡'},
pending_title:{ko:'ìŠ¹ì¸ ëŒ€ê¸° í…ìŠ¤íŠ¸ ëª©ë¡',zh:'å¾…å¯©æ ¸æ–‡æœ¬æ¸…å–®',en:'Pending Text Requests',ja:'æ‰¿èªå¾…ã¡ãƒ†ã‚­ã‚¹ãƒˆä¸€è¦§'},
btn_refresh:{ko:'ìƒˆë¡œê³ ì¹¨',zh:'é‡æ–°æ•´ç†',en:'Refresh',ja:'æ›´æ–°'},
loading:{ko:'ë¡œë”© ì¤‘...',zh:'è¼‰å…¥ä¸­...',en:'Loading...',ja:'èª­ã¿è¾¼ã¿ä¸­...'},
no_data:{ko:'ë°ì´í„° ì—†ìŒ',zh:'ç„¡è³‡æ–™',en:'No data',ja:'ãƒ‡ãƒ¼ã‚¿ãªã—'},
col_rank:{ko:'ìˆœìœ„',zh:'æ’å',en:'Rank',ja:'é †ä½'},
col_nickname:{ko:'ë‹‰ë„¤ì„',zh:'æš±ç¨±',en:'Nickname',ja:'ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ '},
col_typewriter:{ko:'íƒ€ìê¸°',zh:'è¼¸å…¥æ³•',en:'Typewriter',ja:'å…¥åŠ›æ–¹å¼'},
col_text:{ko:'í…ìŠ¤íŠ¸',zh:'æ–‡æœ¬',en:'Text',ja:'ãƒ†ã‚­ã‚¹ãƒˆ'},
col_acc:{ko:'ì •í™•ë„',zh:'æ­£ç¢ºç‡',en:'Accuracy',ja:'æ­£ç¢ºç‡'},
col_completion:{ko:'ì™„ë£Œìœ¨',zh:'å®Œæˆç‡',en:'Completion',ja:'å®Œäº†ç‡'},
col_total_input:{ko:'ì´ ì…ë ¥',zh:'ç¸½è¼¸å…¥',en:'Total Input',ja:'ç·å…¥åŠ›'},
col_date:{ko:'ê¸°ë¡ì¼',zh:'æ—¥æœŸ',en:'Date',ja:'è¨˜éŒ²æ—¥'},
rank_admin_title:{ko:'ğŸ”§ ê´€ë¦¬ì ë­í‚¹ í¸ì§‘',zh:'ğŸ”§ ç®¡ç†å“¡æ’è¡Œç·¨è¼¯',en:'ğŸ”§ Admin Ranking Edit',ja:'ğŸ”§ ç®¡ç†è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç·¨é›†'},
btn_select_all:{ko:'ì „ì²´ ì„ íƒ',zh:'å…¨é¸',en:'Select All',ja:'å…¨é¸æŠ'},
btn_deselect_all:{ko:'ì „ì²´ í•´ì œ',zh:'å…¨ä¸é¸',en:'Deselect All',ja:'å…¨è§£é™¤'},
btn_delete_selected:{ko:'ì„ íƒ ì‚­ì œ',zh:'åˆªé™¤æ‰€é¸',en:'Delete Selected',ja:'é¸æŠå‰Šé™¤'},
btn_delete_board:{ko:'í˜„ì¬ ë³´ë“œ ì „ì²´ ì‚­ì œ',zh:'åˆªé™¤ç•¶å‰å…¨éƒ¨æ’è¡Œ',en:'Delete All in Board',ja:'ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰å…¨å‰Šé™¤'},
n_selected:{ko:'ê°œ ì„ íƒë¨',zh:'å·²é¸æ“‡',en:' selected',ja:'ä»¶é¸æŠä¸­'},
account_title:{ko:'ê³„ì • ì •ë³´',zh:'å¸³è™Ÿè³‡è¨Š',en:'Account Info',ja:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±'},
account_logged_out:{ko:'ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',zh:'è«‹å…ˆç™»å…¥ã€‚',en:'Please log in first.',ja:'ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«åˆ©ç”¨ã§ãã¾ã™ã€‚'},
settings_ui_lang:{ko:'UI ì–¸ì–´',zh:'ä»‹é¢èªè¨€',en:'UI Language',ja:'UIè¨€èª'},
result_title:{ko:'ê²°ê³¼',zh:'çµæœ',en:'Results',ja:'çµæœ'},
result_cpm:{ko:'ë¶„ë‹¹ ê¸€ììˆ˜ (CPM)',zh:'æ¯åˆ†é˜å­—æ•¸ (CPM)',en:'Characters Per Minute (CPM)',ja:'æ–‡å­—/åˆ† (CPM)'},
result_kpm:{ko:'ë¶„ë‹¹ íƒ€ìˆ˜ (KPM)',zh:'æ¯åˆ†é˜æ“Šéµ (KPM)',en:'Keystrokes Per Minute (KPM)',ja:'æ‰“éµ/åˆ† (KPM)'},
result_acc:{ko:'ì •í™•ë„',zh:'æ­£ç¢ºç‡',en:'Accuracy',ja:'æ­£ç¢ºç‡'},
result_elapsed:{ko:'ê²½ê³¼ ì‹œê°„',zh:'ç¶“éæ™‚é–“',en:'Elapsed Time',ja:'çµŒéæ™‚é–“'},
result_completion:{ko:'ì™„ë£Œìœ¨',zh:'å®Œæˆç‡',en:'Completion',ja:'å®Œäº†ç‡'},
result_chars:{ko:'ì´ ì…ë ¥ ê¸€ììˆ˜',zh:'ç¸½è¼¸å…¥å­—æ•¸',en:'Total Input Chars',ja:'ç·å…¥åŠ›æ–‡å­—æ•°'},
btn_close:{ko:'ë‹«ê¸°',zh:'é—œé–‰',en:'Close',ja:'é–‰ã˜ã‚‹'},
btn_register_rank:{ko:'ë­í‚¹ì— ë“±ë¡',zh:'è¨˜éŒ„åˆ°æ’è¡Œæ¦œ',en:'Register Ranking',ja:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²'},
rank_submit_label:{ko:'íƒ€ìê¸° êµ¬ë¶„:',zh:'è¼¸å…¥æ³•ï¼š',en:'Typewriter:',ja:'å…¥åŠ›æ–¹å¼ï¼š'},
rank_submit_placeholder:{ko:'ì˜ˆ) ì°½í, ë‘ë²Œì‹, QWERTY â€¦',zh:'ä¾‹ï¼‰å€‰é ¡ã€æ³¨éŸ³ã€æ‹¼éŸ³ â€¦',en:'e.g.) QWERTY, Dvorak â€¦',ja:'ä¾‹ï¼‰ãƒ­ãƒ¼ãƒå­—ã€ã‹ãªå…¥åŠ› â€¦'},
login_title:{ko:'ë¡œê·¸ì¸',zh:'ç™»å…¥',en:'Login',ja:'ãƒ­ã‚°ã‚¤ãƒ³'},
lbl_password:{ko:'ë¹„ë°€ë²ˆí˜¸',zh:'å¯†ç¢¼',en:'Password',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'},
signup_title:{ko:'íšŒì›ê°€ì…',zh:'è¨»å†Š',en:'Sign Up',ja:'æ–°è¦ç™»éŒ²'},
lbl_pw_confirm:{ko:'ë¹„ë°€ë²ˆí˜¸ í™•ì¸',zh:'ç¢ºèªå¯†ç¢¼',en:'Confirm Password',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª'},
lbl_nickname_rank:{ko:'ë‹‰ë„¤ì„ (ë­í‚¹ í‘œì‹œ)',zh:'æš±ç¨±ï¼ˆæ’è¡Œé¡¯ç¤ºï¼‰',en:'Nickname (for ranking)',ja:'ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºç”¨ï¼‰'},
lbl_email:{ko:'ì´ë©”ì¼',zh:'é›»å­éƒµä»¶',en:'Email',ja:'ãƒ¡ãƒ¼ãƒ«'},
btn_cancel:{ko:'ì·¨ì†Œ',zh:'å–æ¶ˆ',en:'Cancel',ja:'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'},
btn_save:{ko:'ì €ì¥',zh:'å„²å­˜',en:'Save',ja:'ä¿å­˜'},
delete_account_title:{ko:'íšŒì›íƒˆí‡´',zh:'åˆªé™¤å¸³è™Ÿ',en:'Delete Account',ja:'é€€ä¼š'},
delete_warn:{ko:'ê³„ì • ì •ë³´ì™€ ë­í‚¹ ê¸°ë¡ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.',zh:'å¸³è™Ÿè³‡è¨Šå’Œæ’è¡Œç´€éŒ„å°‡è¢«æ°¸ä¹…åˆªé™¤ã€‚',en:'All account data and rankings will be deleted.',ja:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨˜éŒ²ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚'},
delete_confirm_hint:{ko:"'íƒˆí‡´'ë¥¼ ì…ë ¥í•˜ì„¸ìš”",zh:"è«‹è¼¸å…¥ã€Œåˆªé™¤ã€",en:"Type 'delete'",ja:"ã€Œé€€ä¼šã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„"},
delete_confirm_word:{ko:'íƒˆí‡´',zh:'åˆªé™¤',en:'delete',ja:'é€€ä¼š'},
btn_delete:{ko:'íƒˆí‡´',zh:'åˆªé™¤',en:'Delete',ja:'é€€ä¼š'},
user_suffix:{ko:' ë‹˜',zh:'',en:'',ja:''},
lbl_new_pw:{ko:'ìƒˆ ë¹„ë°€ë²ˆí˜¸',zh:'æ–°å¯†ç¢¼',en:'New Password',ja:'æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'},
lbl_confirm_pw:{ko:'í™•ì¸',zh:'ç¢ºèª',en:'Confirm',ja:'ç¢ºèª'},
lbl_del_confirm_input:{ko:"'íƒˆí‡´' ì…ë ¥",zh:"è¼¸å…¥ã€Œåˆªé™¤ã€",en:"Type 'delete'",ja:"ã€Œé€€ä¼šã€ã¨å…¥åŠ›"},
delete_warn_short:{ko:'ê³„ì •ê³¼ ë­í‚¹ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.',zh:'å¸³è™Ÿå’Œæ’è¡Œç´€éŒ„å°‡è¢«æ°¸ä¹…åˆªé™¤ã€‚',en:'All account data and rankings will be deleted.',ja:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚'},
lbl_title:{ko:'ì œëª©',zh:'æ¨™é¡Œ',en:'Title',ja:'ã‚¿ã‚¤ãƒˆãƒ«'},
lbl_content:{ko:'ë‚´ìš©',zh:'å…§å®¹',en:'Content',ja:'å†…å®¹'},
btn_add_text:{ko:'ìƒˆ í…ìŠ¤íŠ¸ ì¶”ê°€',zh:'æ–°å¢æ–‡æœ¬',en:'Add New Text',ja:'æ–°è¦ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ '},
edit_text_title:{ko:'í…ìŠ¤íŠ¸ í¸ì§‘',zh:'ç·¨è¼¯æ–‡æœ¬',en:'Edit Text',ja:'ãƒ†ã‚­ã‚¹ãƒˆç·¨é›†'},
btn_del_text:{ko:'ì‚­ì œ',zh:'åˆªé™¤',en:'Delete',ja:'å‰Šé™¤'},
find_id_title:{ko:'ì•„ì´ë”” ì°¾ê¸°',zh:'æ‰¾å›å¸³è™Ÿ',en:'Find ID',ja:'IDæ¤œç´¢'},
reset_pw_title:{ko:'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •',zh:'é‡è¨­å¯†ç¢¼',en:'Reset Password',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š'},
btn_find:{ko:'ì°¾ê¸°',zh:'æ‰¾å›',en:'Find',ja:'æ¤œç´¢'},
btn_reset_action:{ko:'ì¬ì„¤ì •',zh:'é‡è¨­',en:'Reset',ja:'å†è¨­å®š'},
btn_close_modal:{ko:'ë‹«ê¸°',zh:'é—œé–‰',en:'Close',ja:'é–‰ã˜ã‚‹'},
lang_korean:{ko:'í•œêµ­ì–´',zh:'éŸ“èª',en:'Korean',ja:'éŸ“å›½èª'},
lang_chinese:{ko:'ì¤‘êµ­ì–´',zh:'ä¸­æ–‡',en:'Chinese',ja:'ä¸­å›½èª'},
lang_english:{ko:'ì˜ì–´',zh:'è‹±èª',en:'English',ja:'è‹±èª'},
lang_japanese:{ko:'ì¼ë³¸ì–´',zh:'æ—¥æœ¬èª',en:'Japanese',ja:'æ—¥æœ¬èª'},
no_pending:{ko:'ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ì—†ìŒ',zh:'æ²’æœ‰å¾…å¯©æ ¸çš„è«‹æ±‚',en:'No pending requests',ja:'æ‰¿èªå¾…ã¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã—'},
choose_file:{ko:'íŒŒì¼ ì„ íƒ',zh:'é¸æ“‡æª”æ¡ˆ',en:'Choose File',ja:'ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ'},
no_file_chosen:{ko:'ì„ íƒëœ íŒŒì¼ ì—†ìŒ',zh:'æœªé¸æ“‡æª”æ¡ˆ',en:'No file chosen',ja:'ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ'},
btn_find_id:{ko:'ì•„ì´ë”” ì°¾ê¸°',zh:'æ‰¾å›å¸³è™Ÿ',en:'Find ID',ja:'IDæ¤œç´¢'},
btn_reset_pw:{ko:'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •',zh:'é‡è¨­å¯†ç¢¼',en:'Reset Password',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š'},
btn_withdraw:{ko:'íšŒì›íƒˆí‡´',zh:'åˆªé™¤å¸³è™Ÿ',en:'Delete Account',ja:'é€€ä¼š'},
acct_nickname:{ko:'ë‹‰ë„¤ì„:',zh:'æš±ç¨±ï¼š',en:'Nickname:',ja:'ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼š'},
acct_login_msg:{ko:'ë¡œê·¸ì¸í•˜ë©´ ë­í‚¹ ë“±ë¡ ë“±ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',zh:'ç™»å…¥å¾Œå¯ä½¿ç”¨æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚',en:'Log in to access features like ranking registration.',ja:'ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²ãªã©ã®æ©Ÿèƒ½ãŒä½¿ãˆã¾ã™ã€‚'},
admin_text_mgmt:{ko:'ì„œë²„ í…ìŠ¤íŠ¸ ê´€ë¦¬',zh:'ä¼ºæœå™¨æ–‡æœ¬ç®¡ç†',en:'Server Text Management',ja:'ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†'},
admin_no_text:{ko:'í…ìŠ¤íŠ¸ ì—†ìŒ',zh:'æ²’æœ‰æ–‡æœ¬',en:'No texts',ja:'ãƒ†ã‚­ã‚¹ãƒˆãªã—'},
unit_char:{ko:'ì',zh:'å­—',en:' chars',ja:'å­—'},
btn_edit:{ko:'í¸ì§‘',zh:'ç·¨è¼¯',en:'Edit',ja:'ç·¨é›†'},
lbl_id_min:{ko:'ID (3ì ì´ìƒ)',zh:'å¸³è™Ÿï¼ˆ3å­—ä»¥ä¸Šï¼‰',en:'ID (3+ chars)',ja:'IDï¼ˆ3æ–‡å­—ä»¥ä¸Šï¼‰'},
lbl_pw_min:{ko:'ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)',zh:'å¯†ç¢¼ï¼ˆ4å­—ä»¥ä¸Šï¼‰',en:'Password (4+ chars)',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ4æ–‡å­—ä»¥ä¸Šï¼‰'},
lbl_nick_max:{ko:'ë‹‰ë„¤ì„ (10ì ì´í•˜)',zh:'æš±ç¨±ï¼ˆ10å­—ä»¥ä¸‹ï¼‰',en:'Nickname (max 10)',ja:'ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆ10æ–‡å­—ä»¥ä¸‹ï¼‰'},
btn_join:{ko:'ê°€ì…',zh:'è¨»å†Š',en:'Sign Up',ja:'ç™»éŒ²'},
footer_web_ver:{ko:'ì›¹ ë²„ì „',zh:'ç¶²é ç‰ˆ',en:'Web Version',ja:'Webç‰ˆ'},
msg_enter_id_pw:{ko:'IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.',zh:'è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼ã€‚',en:'Please enter ID and password.',ja:'IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'},
msg_login_fail:{ko:'ë¡œê·¸ì¸ ì‹¤íŒ¨',zh:'ç™»å…¥å¤±æ•—',en:'Login failed',ja:'ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—'},
msg_fill_all:{ko:'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.',zh:'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ã€‚',en:'Please fill in all fields.',ja:'ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'},
msg_fail:{ko:'ì‹¤íŒ¨',zh:'å¤±æ•—',en:'Failed',ja:'å¤±æ•—'},
msg_enter_email:{ko:'ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.',zh:'è«‹è¼¸å…¥é›»å­éƒµä»¶ã€‚',en:'Please enter email.',ja:'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'},
msg_not_found:{ko:'ì—†ìŒ',zh:'æŸ¥ç„¡æ­¤å¸³è™Ÿ',en:'Not found',ja:'è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'},
msg_fill_all_short:{ko:'ëª¨ë“  í•­ëª© ì…ë ¥',zh:'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½',en:'Fill in all fields',ja:'ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„'},
msg_pw_mismatch:{ko:'ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜',zh:'å¯†ç¢¼ä¸ä¸€è‡´',en:'Password mismatch',ja:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸ä¸€è‡´'},
msg_complete:{ko:'ì™„ë£Œ',zh:'å®Œæˆ',en:'Done',ja:'å®Œäº†'},
msg_withdraw_done:{ko:'íƒˆí‡´ ì™„ë£Œ',zh:'å¸³è™Ÿå·²åˆªé™¤',en:'Account deleted',ja:'é€€ä¼šå®Œäº†'},
msg_select_text:{ko:'í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.',zh:'è«‹é¸æ“‡æ–‡æœ¬ã€‚',en:'Please select a text.',ja:'ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'},
msg_enter_typewriter:{ko:'íƒ€ìê¸° êµ¬ë¶„ì„ ì…ë ¥í•˜ì„¸ìš”.',zh:'è«‹è¼¸å…¥è¼¸å…¥æ³•åç¨±ã€‚',en:'Please enter typewriter type.',ja:'å…¥åŠ›æ–¹å¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'},
msg_rank_done:{ko:'ë“±ë¡ ì™„ë£Œ!',zh:'ç™»éŒ„æˆåŠŸï¼',en:'Registered!',ja:'ç™»éŒ²å®Œäº†ï¼'},
msg_select_file:{ko:'íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.',zh:'è«‹é¸æ“‡æª”æ¡ˆã€‚',en:'Please select a file.',ja:'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'},
msg_file_empty:{ko:'íŒŒì¼ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.',zh:'æª”æ¡ˆå…§å®¹ç‚ºç©ºã€‚',en:'File is empty.',ja:'ãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã§ã™ã€‚'},
msg_request_done:{ko:'ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.',zh:'ç”³è«‹å®Œæˆï¼è«‹ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸ã€‚',en:'Request submitted! Waiting for admin approval.',ja:'ç”³è«‹å®Œäº†ï¼ç®¡ç†è€…ã®æ‰¿èªã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚'},
msg_approved:{ko:'âœ… ìŠ¹ì¸ë¨',zh:'âœ… å·²æ‰¹å‡†',en:'âœ… Approved',ja:'âœ… æ‰¿èªæ¸ˆã¿'},
msg_rejected:{ko:'âŒ ê±°ì ˆë¨',zh:'âŒ å·²æ‹’çµ•',en:'âŒ Rejected',ja:'âŒ å´ä¸‹'},
msg_reason:{ko:'ì‚¬ìœ ',zh:'åŸå› ',en:'Reason',ja:'ç†ç”±'},
msg_notif_result:{ko:'í…ìŠ¤íŠ¸ ì‹ ì²­ ê²°ê³¼',zh:'æ–‡æœ¬ç”³è«‹çµæœ',en:'Text Request Result',ja:'ãƒ†ã‚­ã‚¹ãƒˆç”³è«‹çµæœ'},
unit_sec:{ko:'ì´ˆ',zh:'ç§’',en:'s',ja:'ç§’'},
btn_download:{ko:'ë‹¤ìš´ë¡œë“œ',zh:'ä¸‹è¼‰',en:'Download',ja:'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰'},
placeholder_comment:{ko:'ì½”ë©˜íŠ¸ (ì‚¬ìœ )',zh:'å‚™è¨»ï¼ˆåŸå› ï¼‰',en:'Comment (reason)',ja:'ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆç†ç”±ï¼‰'},
btn_approve:{ko:'ìŠ¹ì¸',zh:'æ‰¹å‡†',en:'Approve',ja:'æ‰¿èª'},
btn_reject:{ko:'ê±°ì ˆ',zh:'æ‹’çµ•',en:'Reject',ja:'å´ä¸‹'},
msg_confirm_approve:{ko:'ì´ í…ìŠ¤íŠ¸ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',zh:'ç¢ºå®šè¦æ‰¹å‡†é€™å€‹æ–‡æœ¬å—ï¼Ÿ',en:'Approve this text?',ja:'ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ'},
msg_approve_done:{ko:'ìŠ¹ì¸ ì™„ë£Œ',zh:'æ‰¹å‡†å®Œæˆ',en:'Approved',ja:'æ‰¿èªå®Œäº†'},
msg_confirm_reject:{ko:'ì´ ìš”ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',zh:'ç¢ºå®šè¦æ‹’çµ•é€™å€‹è«‹æ±‚å—ï¼Ÿ',en:'Reject this request?',ja:'ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å´ä¸‹ã—ã¾ã™ã‹ï¼Ÿ'},
msg_reject_done:{ko:'ê±°ì ˆ ì™„ë£Œ',zh:'æ‹’çµ•å®Œæˆ',en:'Rejected',ja:'å´ä¸‹å®Œäº†'},
msg_sel_count:{ko:'{0}/{1}ê°œ ì„ íƒ',zh:'{0}/{1} å·²é¸',en:'{0}/{1} selected',ja:'{0}/{1}ä»¶é¸æŠ'},
msg_no_sel_text:{ko:'ì‚­ì œí•  í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.',zh:'è«‹é¸æ“‡è¦åˆªé™¤çš„æ–‡æœ¬ã€‚',en:'Select texts to delete.',ja:'å‰Šé™¤ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'},
msg_confirm_del_texts:{ko:'ê°œì˜ í…ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',zh:' å€‹æ–‡æœ¬ï¼Œç¢ºå®šåˆªé™¤å—ï¼Ÿ',en:' text(s). Delete?',ja:'ä»¶ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'},
msg_title_content_needed:{ko:'ì œëª©ê³¼ ë‚´ìš© í•„ìš”',zh:'è«‹è¼¸å…¥æ¨™é¡Œå’Œå…§å®¹',en:'Title and content required',ja:'ã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ãŒå¿…è¦ã§ã™'},
msg_save_done:{ko:'ì €ì¥ ì™„ë£Œ!',zh:'å„²å­˜æˆåŠŸï¼',en:'Saved!',ja:'ä¿å­˜å®Œäº†ï¼'},
msg_confirm_delete:{ko:'ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',zh:'ç¢ºå®šåˆªé™¤å—ï¼Ÿ',en:'Delete?',ja:'å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'},
msg_no_sel_rank:{ko:'ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.',zh:'è«‹é¸æ“‡è¦åˆªé™¤çš„é …ç›®ã€‚',en:'Select items to delete.',ja:'å‰Šé™¤ã™ã‚‹é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'},
msg_confirm_del_ranks:{ko:'ê°œì˜ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?',zh:' ç­†è¨˜éŒ„ï¼Œç¢ºå®šåˆªé™¤å—ï¼Ÿ',en:' record(s). Delete?',ja:'ä»¶ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'},
msg_del_rank_done:{ko:'ê±´ ì‚­ì œ ì™„ë£Œ',zh:' ç­†å·²åˆªé™¤',en:' deleted',ja:'ä»¶å‰Šé™¤å®Œäº†'},
msg_select_board:{ko:'íŠ¹ì • í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•œ í›„ ì „ì²´ ì‚­ì œí•˜ì„¸ìš”. (ì „ì²´ ë³´ë“œì—ì„œëŠ” ì‚¬ìš© ë¶ˆê°€)',zh:'è«‹å…ˆé¸æ“‡ç‰¹å®šæ–‡æœ¬å†åˆªé™¤å…¨éƒ¨ã€‚ï¼ˆå…¨éƒ¨æ’è¡Œç„¡æ³•ä½¿ç”¨ï¼‰',en:'Select a specific text first. (Not available for All)',ja:'ç‰¹å®šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ã‹ã‚‰å…¨å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ï¼ˆå…¨ä½“ãƒœãƒ¼ãƒ‰ã§ã¯ä½¿ç”¨ä¸å¯ï¼‰'},
msg_confirm_del_board:{ko:'ë³´ë“œì˜ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?',zh:'æ’è¡Œçš„æ‰€æœ‰è¨˜éŒ„ï¼Œç¢ºå®šåˆªé™¤å—ï¼Ÿ',en:' board? Delete all records?',ja:'ãƒœãƒ¼ãƒ‰ã®å…¨è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'},
msg_del_done:{ko:'ì‚­ì œ ì™„ë£Œ',zh:'åˆªé™¤å®Œæˆ',en:'Deleted',ja:'å‰Šé™¤å®Œäº†'},
tooltip_top:{ko:'ë§¨ ìœ„ë¡œ',zh:'å›åˆ°é ‚éƒ¨',en:'Scroll to top',ja:'ä¸€ç•ªä¸Šã¸'},
tooltip_bottom:{ko:'ë§¨ ì•„ë˜ë¡œ',zh:'åˆ°åº•éƒ¨',en:'Scroll to bottom',ja:'ä¸€ç•ªä¸‹ã¸'},
result_cpm_label:{ko:'CPM (íƒ€/ë¶„)',zh:'CPMï¼ˆå­—/åˆ†ï¼‰',en:'CPM',ja:'CPMï¼ˆå­—/åˆ†ï¼‰'},
result_kpm_label:{ko:'íƒ€ìˆ˜ (KPM)',zh:'æ“Šéµ (KPM)',en:'KPM',ja:'æ‰“éµ (KPM)'},
result_acc_label:{ko:'ì •í™•ë„',zh:'æ­£ç¢ºç‡',en:'Accuracy',ja:'æ­£ç¢ºç‡'},
result_progress_label:{ko:'ì§„í–‰ë¥ ',zh:'é€²åº¦',en:'Progress',ja:'é€²è¡Œç‡'},
result_time_label:{ko:'ì†Œìš” ì‹œê°„',zh:'æ‰€ç”¨æ™‚é–“',en:'Elapsed Time',ja:'çµŒéæ™‚é–“'},
result_chars_label:{ko:'ì´ ê¸€ì',zh:'ç¸½å­—æ•¸',en:'Total Chars',ja:'ç·æ–‡å­—æ•°'},
login_lbl_id:{ko:'ID',zh:'å¸³è™Ÿ',en:'ID',ja:'ID'},
};
let _wlang='ko';
function wt(k){const e=WLANG[k];return e?e[_wlang]||e.ko||k:k;}
function langDisplayName(raw){const m={'í•œêµ­ì–´':'lang_korean','éŸ“èª':'lang_korean','Korean':'lang_korean','éŸ“å›½èª':'lang_korean','ì¤‘êµ­ì–´':'lang_chinese','ä¸­æ–‡':'lang_chinese','Chinese':'lang_chinese','ä¸­å›½èª':'lang_chinese','ì˜ì–´':'lang_english','è‹±èª':'lang_english','English':'lang_english','ì¼ë³¸ì–´':'lang_japanese','æ—¥æœ¬èª':'lang_japanese','Japanese':'lang_japanese'};const k=m[raw];return k?wt(k):raw;}
function setWebLang(code){if(['ko','zh','en','ja'].includes(code)){_wlang=code;localStorage.setItem('ui_lang',code);applyWebLang();}}
function applyWebLang(){
// Tabs
document.querySelectorAll('.tab-btn').forEach(b=>{
const t=b.dataset.tab;if(t==='practice')b.textContent=wt('tab_practice');
else if(t==='settings')b.textContent=wt('tab_settings');
else if(t==='ranking')b.textContent=wt('tab_ranking');
else if(t==='account')b.textContent=wt('tab_account');
else if(t==='admin')b.textContent=wt('tab_admin');
});
// Header buttons
document.getElementById('btnLogin').textContent=wt('btn_login');
document.getElementById('btnSignup').textContent=wt('btn_signup');
document.getElementById('btnLogout').textContent=wt('btn_logout');
if(!currentUser)document.getElementById('userInfo').textContent=wt('not_logged_in');
else document.getElementById('userInfo').textContent=currentUser.nickname+wt('user_suffix');
// Practice controls
const langSel=document.getElementById('langSelect');
if(langSel.options[0])langSel.options[0].textContent=wt('all');
const tSel=document.getElementById('textSelect');
if(tSel.options[0]&&!currentText)tSel.options[0].textContent=wt('select_text');
document.querySelector('.btn-reset').textContent=wt('btn_reset_f11');
const stopBtn=document.querySelector('.btn-stop');
if(stopBtn){if(stopBtn.dataset.state==='result')stopBtn.textContent=wt('btn_result_f12');
else stopBtn.textContent=wt('btn_stop_f12');}
// Stats labels
const slabels=[['stat_time','statTime'],['stat_cpm','statCpm'],['stat_kpm','statKpm'],['stat_acc','statAcc'],['stat_progress','statProgress'],['stat_chars','statChars'],['stat_keys','statKeys']];
slabels.forEach(([k,id])=>{const el=document.getElementById(id);if(el){const p=el.parentElement;if(p){const lbl=p.querySelector('.stat-label');if(lbl)lbl.textContent=wt(k);}}});
const ps=document.getElementById('pauseStatus');if(ps){const sv=ps.querySelector('.stat-value');if(sv)sv.textContent=wt('pause');}
// Pause overlay
document.getElementById('pauseOverlay').textContent=wt('pause_overlay');
// Hotkey hint
const hh=document.querySelector('.hotkey-hint');if(hh)hh.textContent=wt('hotkey_hint');
// Practice msg
const pm=document.getElementById('practiceMsg');if(pm&&!practicing&&!started)pm.innerHTML=wt('practice_msg');
// Prep area
const pl=document.querySelector('.prep-label');if(pl)pl.textContent=wt('prep_label');
const pi=document.getElementById('prepInput');if(pi)pi.placeholder=wt('prep_placeholder');
// Settings
const sps=document.querySelectorAll('#panel-settings .settings-section h3');
const settingsKeys=['settings_ui_lang','settings_unit','settings_font_size','settings_line_height','settings_letter_spacing','settings_sfx','settings_text_request'];
sps.forEach((h,i)=>{if(settingsKeys[i])h.textContent=wt(settingsKeys[i]);});
// Settings labels
const sLabels=document.querySelectorAll('#panel-settings .settings-row label');
const slKeys=['','settings_unit_label','lbl_original_input','','','lbl_sfx','lbl_sfx_type','lbl_volume','lbl_text_file','lbl_lang'];
sLabels.forEach((l,i)=>{if(slKeys[i])l.textContent=wt(slKeys[i]);});
// Unit mode options
const usel=document.getElementById('settingUnitMode');
if(usel){usel.options[0].textContent=wt('unit_line');usel.options[1].textContent=wt('unit_para');}
// Unit note
const unote=document.querySelector('#panel-settings .settings-section:nth-child(2) p');
if(unote)unote.textContent=wt('unit_note');
// SFX options
const sfxEn=document.getElementById('settingSfxEnabled');
if(sfxEn){sfxEn.options[0].textContent=wt('sfx_on');sfxEn.options[1].textContent=wt('sfx_off');}
const sfxSt=document.getElementById('settingSfxStyle');
if(sfxSt){const sfxK=['sfx_typewriter','sfx_retro','sfx_analog','sfx_mechanical','sfx_soft'];sfxSt.querySelectorAll('option').forEach((o,i)=>{if(sfxK[i])o.textContent=wt(sfxK[i]);});}
// Text request
const trDesc=document.querySelector('#panel-settings .settings-section:nth-child(7) > p');
if(trDesc)trDesc.textContent=wt('text_req_desc');
const trLogin=document.getElementById('textRequestLogin');
if(trLogin)trLogin.innerHTML='<p style="color:#dc2626;font-size:.85rem">'+wt('text_req_login')+'</p>';
const trBtn=document.querySelector('#textRequestForm .btn-primary');
if(trBtn)trBtn.textContent=wt('btn_submit');
// Pending
const pdTitle=document.querySelector('#pendingRequestsSection h3');
if(pdTitle)pdTitle.textContent=wt('pending_title');
const pdRefresh=document.querySelector('#pendingRequestsSection .btn-secondary');
if(pdRefresh)pdRefresh.textContent=wt('btn_refresh');
// Ranking headers
const ths=document.querySelectorAll('.ranking-table thead th');
const thKeys=['col_rank','col_nickname','col_typewriter','col_text','','','col_acc','col_completion','col_total_input','col_date'];
ths.forEach((th,i)=>{if(thKeys[i])th.textContent=wt(thKeys[i]);});
// Ranking controls
const rbs=document.getElementById('rankBoardSelect');
if(rbs&&rbs.options[0])rbs.options[0].textContent=wt('all');
const rrBtn=document.querySelector('.ranking-controls .btn-primary');
if(rrBtn)rrBtn.textContent=wt('btn_refresh');
// Ranking admin panel
const rap=document.getElementById('rankAdminPanel');
if(rap){const btns=rap.querySelectorAll('button');
if(btns[0])btns[0].textContent=wt('btn_select_all');
if(btns[1])btns[1].textContent=wt('btn_deselect_all');
if(btns[2])btns[2].textContent=wt('btn_delete_selected');
if(btns[3])btns[3].textContent=wt('btn_delete_board');
const st=rap.querySelector('strong');if(st)st.textContent=wt('rank_admin_title');}
// Account
const acctTitle=document.querySelector('#panel-account .settings-section h3');
if(acctTitle)acctTitle.textContent=wt('account_title');
const acctLogout=document.getElementById('accountLoggedOut');
if(acctLogout)acctLogout.innerHTML='<p>'+wt('account_logged_out')+'</p>';
// Result modal headers
const rsh=document.querySelectorAll('#resultsModal .result-row .result-label');
const rsKeys=['result_cpm','result_kpm','result_acc','result_elapsed','result_completion','result_chars'];
rsh.forEach((l,i)=>{if(rsKeys[i])l.textContent=wt(rsKeys[i]);});
const rmTitle=document.querySelector('#resultsModal h2');
if(rmTitle)rmTitle.textContent=wt('result_title');
const rsClose=document.querySelector('#resultsModal .modal-actions .btn-secondary');
if(rsClose)rsClose.textContent=wt('btn_close');
// Rank submit in result modal
const rsl=document.getElementById('rankSubmitArea');
if(rsl){const lb=rsl.querySelector('label');if(lb)lb.textContent=wt('rank_submit_label');
const inp=rsl.querySelector('input[type=text]');if(inp)inp.placeholder=wt('rank_submit_placeholder');
const btn=rsl.querySelector('.btn-primary');if(btn)btn.textContent=wt('btn_register_rank');}
// Login modal
const lmTitle=document.querySelector('#loginModal h2');
if(lmTitle)lmTitle.textContent=wt('login_title');
// Signup modal
const smTitle=document.querySelector('#signupModal h2');
if(smTitle)smTitle.textContent=wt('signup_title');
const smLabels=document.querySelectorAll('#signupModal .modal-field label');
if(smLabels[0])smLabels[0].textContent=wt('lbl_id_min');
if(smLabels[1])smLabels[1].textContent=wt('lbl_pw_min');
if(smLabels[2])smLabels[2].textContent=wt('lbl_nick_max');
if(smLabels[3])smLabels[3].textContent=wt('lbl_email');
const smBtns=document.querySelectorAll('#signupModal .modal-actions button');
if(smBtns[0])smBtns[0].textContent=wt('btn_cancel');
if(smBtns[1])smBtns[1].textContent=wt('btn_join');
// Delete account modal
const dmTitle=document.querySelector('#deleteAccountModal h2');
if(dmTitle)dmTitle.textContent=wt('delete_account_title');
// UI language selector
const uls=document.getElementById('settingUILang');
if(uls)uls.value=_wlang;
const ulLabel=document.getElementById('uiLangLabel');
if(ulLabel)ulLabel.textContent=wt('settings_ui_lang');
// [3] Login modal: password label, cancel, login buttons
const lmLabels=document.querySelectorAll('#loginModal .modal-field label');
if(lmLabels[1])lmLabels[1].textContent=wt('lbl_password');
const lmBtns=document.querySelectorAll('#loginModal .modal-actions button');
if(lmBtns[0])lmBtns[0].textContent=wt('btn_cancel');
if(lmBtns[1])lmBtns[1].textContent=wt('btn_login');
// [5] Find ID modal: title, email label, buttons
const fiTitle=document.querySelector('#findIdModal h2');
if(fiTitle)fiTitle.textContent=wt('find_id_title');
const fiLabels=document.querySelectorAll('#findIdModal .modal-field label');
if(fiLabels[0])fiLabels[0].textContent=wt('lbl_email');
const fiBtns=document.querySelectorAll('#findIdModal .modal-actions button');
if(fiBtns[0])fiBtns[0].textContent=wt('btn_close_modal');
if(fiBtns[1])fiBtns[1].textContent=wt('btn_find');
// [6] Reset PW modal: title, labels, buttons
const rpTitle=document.querySelector('#resetPwModal h2');
if(rpTitle)rpTitle.textContent=wt('reset_pw_title');
const rpLabels=document.querySelectorAll('#resetPwModal .modal-field label');
if(rpLabels[1])rpLabels[1].textContent=wt('lbl_email');
if(rpLabels[2])rpLabels[2].textContent=wt('lbl_new_pw');
if(rpLabels[3])rpLabels[3].textContent=wt('lbl_confirm_pw');
const rpBtns=document.querySelectorAll('#resetPwModal .modal-actions button');
if(rpBtns[0])rpBtns[0].textContent=wt('btn_close_modal');
if(rpBtns[1])rpBtns[1].textContent=wt('btn_reset_action');
// [7] Delete account modal: title, warning, labels, buttons
const daWarn=document.querySelector('#deleteAccountModal > .modal > p');
if(daWarn)daWarn.textContent=wt('delete_warn_short');
const daLabels=document.querySelectorAll('#deleteAccountModal .modal-field label');
if(daLabels[0])daLabels[0].textContent=wt('lbl_password');
if(daLabels[1])daLabels[1].textContent=wt('lbl_del_confirm_input');
const daBtns=document.querySelectorAll('#deleteAccountModal .modal-actions button');
if(daBtns[0])daBtns[0].textContent=wt('btn_cancel');
if(daBtns[1])daBtns[1].textContent=wt('btn_delete');
// [8] Edit text modal: title already handled, labels, buttons
const etLabels=document.querySelectorAll('#editTextModal .modal-field label');
if(etLabels[0])etLabels[0].textContent=wt('lbl_title');
if(etLabels[1])etLabels[1].textContent=wt('lbl_lang');
if(etLabels[2])etLabels[2].textContent=wt('lbl_content');
const etBtns=document.querySelectorAll('#editTextModal .modal-actions button');
if(etBtns[0])etBtns[0].textContent=wt('btn_del_text');
if(etBtns[1])etBtns[1].textContent=wt('btn_cancel');
if(etBtns[2])etBtns[2].textContent=wt('btn_save');
// [9] Practice language dropdown option names
const langSelAll=document.getElementById('langSelect');
if(langSelAll){for(let i=1;i<langSelAll.options.length;i++){langSelAll.options[i].textContent=langDisplayName(langSelAll.options[i].value);}}
// [10] Text request: custom file button, filename, language dropdown
const rfb=document.getElementById('reqFileBtn');if(rfb)rfb.textContent=wt('choose_file');
const rfn=document.getElementById('reqFileName');if(rfn&&!document.getElementById('reqTextFile').files.length)rfn.textContent=wt('no_file_chosen');
const rtl=document.getElementById('reqTextLang');
if(rtl){const rlK=['lang_korean','lang_chinese','lang_english','lang_japanese'];rtl.querySelectorAll('option').forEach((o,i)=>{if(rlK[i])o.textContent=wt(rlK[i]);});}
// [10] editTextLang dropdown
const etlSel=document.getElementById('editTextLang');
if(etlSel){const elk=['lang_korean','lang_chinese','lang_english','lang_japanese'];etlSel.querySelectorAll('option').forEach((o,i)=>{if(elk[i])o.textContent=wt(elk[i]);});}
// [11] Pending empty (detect current text)
const pdl=document.getElementById('pendingRequestsList');
if(pdl){const pd=pdl.querySelector('div');if(pd&&!pdl.querySelector('.pending-item')){const t=pd.textContent.trim();if(t){const isLoading=t.includes('...')||t===wt('loading');pd.textContent=isLoading?wt('loading'):wt('no_pending');}}}
// [13] Account tab
const acctLoginMsg=document.getElementById('acctLoginMsg');if(acctLoginMsg)acctLoginMsg.textContent=wt('acct_login_msg');
const acctBtnLogin=document.getElementById('acctBtnLogin');if(acctBtnLogin)acctBtnLogin.textContent=wt('btn_login');
const acctBtnSignup=document.getElementById('acctBtnSignup');if(acctBtnSignup)acctBtnSignup.textContent=wt('btn_signup');
const acctInfoTitle=document.getElementById('acctInfoTitle');if(acctInfoTitle)acctInfoTitle.textContent=wt('account_title');
const acctNickLabel=document.getElementById('acctNickLabel');if(acctNickLabel)acctNickLabel.textContent=wt('acct_nickname');
const acctBtnFindId=document.getElementById('acctBtnFindId');if(acctBtnFindId)acctBtnFindId.textContent=wt('btn_find_id');
const acctBtnResetPw=document.getElementById('acctBtnResetPw');if(acctBtnResetPw)acctBtnResetPw.textContent=wt('btn_reset_pw');
const acctBtnWithdraw=document.getElementById('acctBtnWithdraw');if(acctBtnWithdraw)acctBtnWithdraw.textContent=wt('btn_withdraw');
// [14] Admin tab
const adminMgmtTitle=document.getElementById('adminMgmtTitle');
if(adminMgmtTitle){const cnt=document.getElementById('adminTotalCount');adminMgmtTitle.textContent=wt('admin_text_mgmt')+' ';if(cnt)adminMgmtTitle.appendChild(cnt);}
const adminBtnAdd=document.getElementById('adminBtnAdd');if(adminBtnAdd)adminBtnAdd.textContent=wt('btn_add_text');
const adminBtnRefresh=document.getElementById('adminBtnRefresh');if(adminBtnRefresh)adminBtnRefresh.textContent=wt('btn_refresh');
const alf=document.getElementById('adminLangFilter');
if(alf){if(alf.options[0])alf.options[0].textContent=wt('all');for(let i=1;i<alf.options.length;i++){alf.options[i].textContent=langDisplayName(alf.options[i].value);}}
const adminBtnSelAll=document.getElementById('adminBtnSelAll');if(adminBtnSelAll)adminBtnSelAll.textContent=wt('btn_select_all');
const adminBtnDeselAll=document.getElementById('adminBtnDeselAll');if(adminBtnDeselAll)adminBtnDeselAll.textContent=wt('btn_deselect_all');
const adminBtnDelSel=document.getElementById('adminBtnDelSel');if(adminBtnDelSel)adminBtnDelSel.textContent=wt('btn_delete_selected');
// [14] Admin loading/empty text
const atl=document.getElementById('adminTextList');
if(atl&&atl.children.length===1&&!atl.querySelector('.admin-text-item')){const d=atl.children[0];if(d)d.textContent=wt('loading');}
// [15] Footer
const fwv=document.getElementById('footerWebVer');if(fwv)fwv.textContent=wt('footer_web_ver');
}

let currentUser=null,allTexts=[],texts=[],languages=[];
let currentText=null,practicing=false,started=false,paused=false;
let startTime=null,timerInterval=null,keystrokes=0;
let totalPausedMs=0,pauseStartTime=null;
let lines=[],currentLineIdx=0,lineInputs=[],lineDisplays=[],lineBlocks=[];
let unitMode='line',manualPause=false;
let adminAllTexts=[];
let rawParagraphs=[]; /* FIX#1: preserve original paragraphs for reflow */

/* SFX */
let sfxEnabled=false,sfxStyle='typewriter',sfxVolume=0.5;
const sfxBuffers={};let sfxCtx=null;
const SFX_URLS={typewriter:'/static/sfx/sfx_typewriter.wav',retro:'/static/sfx/sfx_retro.wav',analog:'/static/sfx/sfx_analog.wav',mechanical:'/static/sfx/sfx_mechanical.wav'};
async function loadSfxBuffer(key){if(sfxBuffers[key])return;try{if(!sfxCtx)sfxCtx=new(window.AudioContext||window.webkitAudioContext)();const url=SFX_URLS[key];if(!url)return;const resp=await fetch(url);const ab=await resp.arrayBuffer();sfxBuffers[key]=await sfxCtx.decodeAudioData(ab);}catch(e){}}
function playSfx(){if(!sfxEnabled)return;try{if(!sfxCtx)sfxCtx=new(window.AudioContext||window.webkitAudioContext)();if(sfxStyle==='soft'){const o=sfxCtx.createOscillator(),g=sfxCtx.createGain();o.connect(g);g.connect(sfxCtx.destination);const t=sfxCtx.currentTime;o.type='sine';o.frequency.setValueAtTime(600,t);g.gain.setValueAtTime(sfxVolume*0.15,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.04);o.start(t);o.stop(t+0.04);return;}const buf=sfxBuffers[sfxStyle];if(!buf){loadSfxBuffer(sfxStyle);return;}const src=sfxCtx.createBufferSource(),g=sfxCtx.createGain();src.buffer=buf;src.connect(g);g.connect(sfxCtx.destination);g.gain.value=sfxVolume;src.start(0);}catch(e){}}
function preloadAllSfx(){for(const k of Object.keys(SFX_URLS))loadSfxBuffer(k);}

function normalizeFullwidth(s){let o='';for(let i=0;i<s.length;i++){const c=s.charCodeAt(i);if(c>=0xFF10&&c<=0xFF19)o+=String.fromCharCode(c-0xFEE0);else if(c>=0xFF21&&c<=0xFF3A)o+=String.fromCharCode(c-0xFEE0);else if(c>=0xFF41&&c<=0xFF5A)o+=String.fromCharCode(c-0xFEE0);else o+=s[i];}return o;}
function stripLeadingBlanks(s){return s.replace(/^[\s\u3000\u00A0\t\u0020]+/,'');}

async function api(ep,method='GET',data=null){const o={method,headers:{'Content-Type':'application/json'}};if(currentUser?.token)o.headers['Authorization']='Bearer '+currentUser.token;if(data)o.body=JSON.stringify(data);try{const r=await fetch(API+ep,o);return await r.json();}catch(e){return null;}}

/* Tabs */
document.querySelectorAll('.tab-btn').forEach(b=>{b.addEventListener('click',()=>{
  const prevTab=document.querySelector('.tab-btn.active')?.dataset.tab;
  document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');document.getElementById('panel-'+b.dataset.tab).classList.add('active');
  if(b.dataset.tab==='ranking')loadRankings();
  if(b.dataset.tab==='admin')refreshAdminTextList();
  if(b.dataset.tab==='settings'){updateTextRequestUI();if(isAdmin())loadPendingRequests();}
  if(prevTab==='practice'&&b.dataset.tab!=='practice'&&practicing&&started&&!paused){doPause(false,true);}
  if(b.dataset.tab==='practice'&&paused&&practicing){document.getElementById('pauseOverlay').classList.add('active');}
});});

/* Auth */
function isAdmin(){return currentUser?.user_id===ADMIN_ID;}
function updateAuthUI(){const i=document.getElementById('userInfo');if(currentUser){i.textContent=currentUser.nickname+wt('user_suffix');document.getElementById('btnLogin').style.display='none';document.getElementById('btnSignup').style.display='none';document.getElementById('btnLogout').style.display='';document.getElementById('accountLoggedOut').style.display='none';document.getElementById('accountLoggedIn').style.display='';document.getElementById('acctId').textContent=currentUser.user_id;document.getElementById('acctNick').textContent=currentUser.nickname;document.getElementById('rankSubmitArea').style.display='';}else{i.textContent=wt('not_logged_in');document.getElementById('btnLogin').style.display='';document.getElementById('btnSignup').style.display='';document.getElementById('btnLogout').style.display='none';document.getElementById('accountLoggedOut').style.display='';document.getElementById('accountLoggedIn').style.display='none';document.getElementById('rankSubmitArea').style.display='none';}document.getElementById('tabAdmin').style.display=isAdmin()?'':'none';document.getElementById('rankAdminPanel').style.display=isAdmin()?'':'none';updateTextRequestUI();}
function showLoginModal(){openModal('loginModal');document.getElementById('loginId').focus();}
function showSignupModal(){openModal('signupModal');document.getElementById('signupId').focus();}
function showFindIdModal(){openModal('findIdModal');document.getElementById('findIdEmail').focus();}
function showResetPwModal(){openModal('resetPwModal');document.getElementById('resetPwId').focus();}
function showDeleteAccountModal(){openModal('deleteAccountModal');document.getElementById('delAcctPw').focus();}
async function doLogin(){const id=document.getElementById('loginId').value.trim(),pw=document.getElementById('loginPw').value;if(!id||!pw){document.getElementById('loginMsg').textContent=wt('msg_enter_id_pw');return;}const r=await api('/api/login','POST',{user_id:id,password:pw});if(r?.ok){currentUser={user_id:r.user_id,nickname:r.nickname,token:r.token};localStorage.setItem('auth',JSON.stringify(currentUser));closeModal('loginModal');updateAuthUI();checkNotifications();}else{document.getElementById('loginMsg').textContent=r?.msg||wt('msg_login_fail');}}
async function doSignup(){const id=document.getElementById('signupId').value.trim(),pw=document.getElementById('signupPw').value,nk=document.getElementById('signupNick').value.trim(),em=document.getElementById('signupEmail').value.trim();if(!id||!pw||!nk||!em){document.getElementById('signupMsg').textContent=wt('msg_fill_all');return;}const r=await api('/api/signup','POST',{user_id:id,password:pw,nickname:nk,email:em});if(r?.ok){currentUser={user_id:r.user_id,nickname:r.nickname,token:r.token};localStorage.setItem('auth',JSON.stringify(currentUser));closeModal('signupModal');updateAuthUI();}else{document.getElementById('signupMsg').textContent=r?.msg||wt('msg_fail');}}
async function doLogout(){await api('/api/logout','POST');currentUser=null;localStorage.removeItem('auth');updateAuthUI();document.getElementById('notifArea').innerHTML='';}
async function doFindId(){const em=document.getElementById('findIdEmail').value.trim();if(!em){document.getElementById('findIdMsg').textContent=wt('msg_enter_email');return;}const r=await api('/api/find-id','POST',{email:em});const m=document.getElementById('findIdMsg');if(r?.ok){m.className='modal-msg success';m.textContent='ID: '+r.user_id;}else{m.className='modal-msg';m.textContent=r?.msg||wt('msg_not_found');}}
async function doResetPw(){const id=document.getElementById('resetPwId').value.trim(),em=document.getElementById('resetPwEmail').value.trim(),p1=document.getElementById('resetPwNew').value,p2=document.getElementById('resetPwConfirm').value;if(!id||!em||!p1){document.getElementById('resetPwMsg').textContent=wt('msg_fill_all_short');return;}if(p1!==p2){document.getElementById('resetPwMsg').textContent=wt('msg_pw_mismatch');return;}const r=await api('/api/reset-password','POST',{user_id:id,email:em,new_password:p1});const m=document.getElementById('resetPwMsg');if(r?.ok){m.className='modal-msg success';m.textContent=wt('msg_complete');}else{m.className='modal-msg';m.textContent=r?.msg||wt('msg_fail');}}
async function doDeleteAccount(){const pw=document.getElementById('delAcctPw').value,cf=document.getElementById('delAcctConfirm').value.trim();if(cf!==wt('delete_confirm_word')){document.getElementById('delAcctMsg').textContent=wt('delete_confirm_hint');return;}const r=await api('/api/delete-account','POST',{password:pw});if(r?.ok){currentUser=null;localStorage.removeItem('auth');closeModal('deleteAccountModal');updateAuthUI();alert(wt('msg_withdraw_done'));}else{document.getElementById('delAcctMsg').textContent=r?.msg||wt('msg_fail');}}

/* FIX#5: Notification â€” check for text request results on login */
async function checkNotifications(){
  if(!currentUser||isAdmin())return;
  const r=await api('/api/text-requests/notifications');
  if(!r?.ok||!r.notifications?.length)return;
  const area=document.getElementById('notifArea');let html='';const ids=[];
  for(const n of r.notifications){
    ids.push(n.id);
    const st=n.status==='approved'?wt('msg_approved'):wt('msg_rejected');
    const cm=n.review_comment?' â€” '+wt('msg_reason')+': '+esc(n.review_comment):'';
    html+='<div class="notif-banner"><button class="notif-close" onclick="this.parentElement.remove()">âœ•</button><div class="notif-title">'+ wt('msg_notif_result')+': '+esc(n.title)+'</div>'+st+cm+'</div>';
  }
  area.innerHTML=html;
  if(ids.length)api('/api/text-requests/notifications/ack','POST',{ids});
}

/* Modal helpers */
function openModal(id){document.querySelectorAll('#'+id+' .modal-msg').forEach(m=>m.textContent='');document.getElementById(id).classList.add('active');}
function closeModal(id){document.getElementById(id).classList.remove('active');}
document.addEventListener('keydown',e=>{if(e.key==='Escape'&&document.querySelector('.modal-overlay.active:not(#pauseOverlay)')){document.querySelectorAll('.modal-overlay.active:not(#pauseOverlay)').forEach(m=>m.classList.remove('active'));e.preventDefault();e.stopPropagation();return;}});
document.getElementById('loginPw')?.addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
document.getElementById('signupEmail')?.addEventListener('keydown',e=>{if(e.key==='Enter')doSignup();});

/* Texts */
function populateTextSelect(tl,ll){allTexts=tl;languages=ll||[];const ls=document.getElementById('langSelect'),pv=ls.value;ls.innerHTML='<option value="">'+wt('all')+'</option>';languages.forEach(l=>{const o=document.createElement('option');o.value=l;o.textContent=langDisplayName(l);ls.appendChild(o);});ls.value=pv;filterTexts();}
function filterTexts(){const lang=document.getElementById('langSelect').value;texts=lang?allTexts.filter(t=>(t.language||'')===lang):[...allTexts];const s=document.getElementById('textSelect'),pv=s.value;s.innerHTML='<option value="">'+wt('select_text')+'</option>';texts.forEach(t=>{const o=document.createElement('option');o.value=t.id;o.textContent=t.title+' ('+t.content.length+wt('unit_char')+')';s.appendChild(o);});if(pv)s.value=pv;}
document.getElementById('langSelect').addEventListener('change',filterTexts);
document.getElementById('textSelect').addEventListener('change',function(){if(this.value)startPractice();});
async function loadTexts(){const r=await api('/api/texts');if(r?.ok){populateTextSelect(r.texts,r.languages);try{localStorage.setItem('cachedTexts',JSON.stringify({texts:r.texts,languages:r.languages}));}catch(e){}}}

/* Settings */
function loadSettings(){try{const s=JSON.parse(localStorage.getItem('webSettings')||'{}');unitMode=s.unitMode||'line';document.getElementById('settingUnitMode').value=unitMode;if(s.fontSize)document.getElementById('settingFontSize').value=s.fontSize;if(s.lineHeight)document.getElementById('settingLineHeight').value=s.lineHeight;if(s.letterSpacing!=null)document.getElementById('settingLetterSpacing').value=s.letterSpacing;sfxEnabled=(s.sfxEnabled==='on');document.getElementById('settingSfxEnabled').value=sfxEnabled?'on':'off';sfxStyle=s.sfxStyle||'typewriter';document.getElementById('settingSfxStyle').value=sfxStyle;sfxVolume=s.sfxVolume!=null?parseFloat(s.sfxVolume)/100:0.5;document.getElementById('settingSfxVolume').value=Math.round(sfxVolume*100);document.getElementById('sfxVolLabel').textContent=Math.round(sfxVolume*100)+'%';}catch(e){}applyFontSettings();}
function saveSettings(){const s={unitMode:document.getElementById('settingUnitMode').value,fontSize:document.getElementById('settingFontSize').value,lineHeight:document.getElementById('settingLineHeight').value,letterSpacing:document.getElementById('settingLetterSpacing').value,sfxEnabled:document.getElementById('settingSfxEnabled').value,sfxStyle:document.getElementById('settingSfxStyle').value,sfxVolume:document.getElementById('settingSfxVolume').value};unitMode=s.unitMode;sfxEnabled=(s.sfxEnabled==='on');sfxStyle=s.sfxStyle;sfxVolume=parseInt(s.sfxVolume)/100;document.getElementById('sfxVolLabel').textContent=s.sfxVolume+'%';localStorage.setItem('webSettings',JSON.stringify(s));applyFontSettings();if(sfxEnabled&&SFX_URLS[sfxStyle])loadSfxBuffer(sfxStyle);}
function applyFontSettings(){document.documentElement.style.setProperty('--pfs',document.getElementById('settingFontSize').value+'px');document.documentElement.style.setProperty('--plh',document.getElementById('settingLineHeight').value);document.documentElement.style.setProperty('--pls',document.getElementById('settingLetterSpacing').value+'px');}
['settingUnitMode','settingFontSize','settingLineHeight','settingLetterSpacing','settingSfxEnabled','settingSfxStyle','settingSfxVolume'].forEach(id=>{document.getElementById(id).addEventListener('change',saveSettings);document.getElementById(id).addEventListener('input',saveSettings);});

/* Text request */
function updateTextRequestUI(){document.getElementById('textRequestLogin').style.display=currentUser?'none':'';document.getElementById('textRequestForm').style.display=currentUser?'':'none';document.getElementById('pendingRequestsSection').style.display=isAdmin()?'':'none';}
async function submitTextRequest(){const fileInput=document.getElementById('reqTextFile'),lang=document.getElementById('reqTextLang').value,m=document.getElementById('reqTextMsg');if(!fileInput.files.length){m.textContent=wt('msg_select_file');return;}const file=fileInput.files[0],text=await file.text(),title=file.name.replace(/\.txt$/i,'').trim();if(!text.trim()){m.textContent=wt('msg_file_empty');return;}const r=await api('/api/text-requests','POST',{title,content:text.trim(),language:lang});if(r?.ok){m.className='modal-msg success';m.textContent=wt('msg_request_done');fileInput.value='';}else{m.className='modal-msg';m.textContent=r?.msg||wt('msg_fail');}}

/* FIX#4: Pending requests with comment input */
async function loadPendingRequests(){
  const r=await api('/api/text-requests');if(!r?.ok)return;
  const list=document.getElementById('pendingRequestsList');
  const pending=(r.requests||[]).filter(x=>x.status==='pending');
  if(pending.length===0){list.innerHTML='<div style="padding:20px;text-align:center;color:#94a3b8">'+wt('no_pending')+'</div>';return;}
  list.innerHTML=pending.map(req=>{
    const d=req.created_at?new Date(req.created_at).toLocaleString(_wlang==='ko'?'ko':_wlang==='zh'?'zh-TW':_wlang==='ja'?'ja':'en'):'';
    return '<div class="pending-item">'+
      '<div style="display:flex;align-items:center;justify-content:space-between;gap:8px">'+
        '<div style="flex:1;min-width:0"><div style="font-weight:600;font-size:.9rem">'+esc(req.title)+'</div>'+
        '<div style="font-size:.75rem;color:#94a3b8">'+esc(req.nickname)+' Â· '+esc(req.language)+' Â· '+req.content.length+wt('unit_char')+' Â· '+d+'</div></div>'+
        '<a href="data:text/plain;charset=utf-8,'+encodeURIComponent(req.content)+'" download="'+esc(req.title)+'.txt" style="padding:4px 10px;font-size:.75rem;background:#e2e8f0;border-radius:6px;color:#475569;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;flex-shrink:0">'+wt('btn_download')+'</a>'+
      '</div>'+
      '<div style="display:flex;gap:6px;align-items:center">'+
        '<input type="text" id="reqComment'+req.id+'" placeholder="'+wt('placeholder_comment')+'" style="flex:1;padding:4px 8px;font-size:.8rem">'+
        '<button class="btn-primary" style="padding:4px 10px;font-size:.75rem" onclick="approveRequest('+req.id+')">'+wt('btn_approve')+'</button>'+
        '<button class="btn-danger" style="padding:4px 10px;font-size:.75rem" onclick="rejectRequest('+req.id+')">'+wt('btn_reject')+'</button>'+
      '</div></div>';
  }).join('');
}
async function approveRequest(id){if(!confirm(wt('msg_confirm_approve')))return;const comment=(document.getElementById('reqComment'+id)?.value||'').trim();const r=await api('/api/text-requests/'+id+'/approve','POST',{comment});if(r?.ok){alert(r.msg||wt('msg_approve_done'));loadPendingRequests();loadTexts();}else{alert(r?.msg||wt('msg_fail'));}}
async function rejectRequest(id){if(!confirm(wt('msg_confirm_reject')))return;const comment=(document.getElementById('reqComment'+id)?.value||'').trim();const r=await api('/api/text-requests/'+id+'/reject','POST',{comment});if(r?.ok){alert(wt('msg_reject_done'));loadPendingRequests();}else{alert(r?.msg||wt('msg_fail'));}}

/* Admin text management */
async function refreshAdminTextList(){const r=await api('/api/texts');if(!r?.ok)return;adminAllTexts=r.texts;const af=document.getElementById('adminLangFilter'),pv=af.value;const langs=[...new Set(r.texts.map(t=>t.language||'').filter(Boolean))];af.innerHTML='<option value="">'+wt('all')+'</option>';langs.forEach(l=>{const o=document.createElement('option');o.value=l;o.textContent=langDisplayName(l);af.appendChild(o);});af.value=pv;renderAdminList();}
document.getElementById('adminLangFilter').addEventListener('change',renderAdminList);
function renderAdminList(){const lang=document.getElementById('adminLangFilter').value;const filtered=lang?adminAllTexts.filter(t=>(t.language||'')===lang):adminAllTexts;document.getElementById('adminTotalCount').textContent='('+filtered.length+')';document.getElementById('adminSelCount').textContent='';const l=document.getElementById('adminTextList');if(filtered.length===0){l.innerHTML='<div style="padding:20px;text-align:center;color:#94a3b8">'+wt('admin_no_text')+'</div>';return;}l.innerHTML=filtered.map(t=>'<div class="admin-text-item"><label style="display:flex;align-items:center;gap:6px;cursor:pointer;flex-shrink:0"><input type="checkbox" class="admin-chk" data-id="'+t.id+'" onchange="updateAdminSelCount()"></label><div class="admin-text-info"><div class="admin-text-title">'+esc(t.title)+'</div><div class="admin-text-meta">'+langDisplayName(t.language)+' Â· '+t.content.length+wt('unit_char')+'</div></div><div class="admin-text-actions"><button class="btn-primary" onclick="showEditTextModal('+t.id+')">'+wt('btn_edit')+'</button><button class="btn-danger" onclick="doDeleteTextDirect('+t.id+',\''+esc(t.title).replace(/'/g,"\\'")+'\')">'+wt('btn_del_text')+'</button></div></div>').join('');}
function adminSelectAll(checked){document.querySelectorAll('.admin-chk').forEach(c=>c.checked=checked);updateAdminSelCount();}
function updateAdminSelCount(){const sel=document.querySelectorAll('.admin-chk:checked').length;const total=document.querySelectorAll('.admin-chk').length;document.getElementById('adminSelCount').textContent=sel>0?wt('msg_sel_count').replace('{0}',sel).replace('{1}',total):'';}
async function adminDeleteSelected(){const ids=[...document.querySelectorAll('.admin-chk:checked')].map(c=>parseInt(c.dataset.id));if(ids.length===0){alert(wt('msg_no_sel_text'));return;}if(!confirm(ids.length+wt('msg_confirm_del_texts')))return;for(const id of ids){await api('/api/texts/'+id,'DELETE');}await loadTexts();refreshAdminTextList();}
function showAddTextModal(){document.getElementById('editTextTitle').textContent=wt('btn_add_text');document.getElementById('editTextId').value='';document.getElementById('editTextName').value='';document.getElementById('editTextLang').value='í•œêµ­ì–´';document.getElementById('editTextContent').value='';document.getElementById('btnDeleteText').style.display='none';openModal('editTextModal');document.getElementById('editTextName').focus();}
function showEditTextModal(id){const t=allTexts.find(x=>x.id===id)||adminAllTexts.find(x=>x.id===id);if(!t)return;document.getElementById('editTextTitle').textContent=wt('edit_text_title');document.getElementById('editTextId').value=id;document.getElementById('editTextName').value=t.title;document.getElementById('editTextLang').value=t.language||'í•œêµ­ì–´';document.getElementById('editTextContent').value=t.content;document.getElementById('btnDeleteText').style.display='';openModal('editTextModal');}
async function doSaveText(){const id=document.getElementById('editTextId').value,ti=document.getElementById('editTextName').value.trim(),la=document.getElementById('editTextLang').value,co=document.getElementById('editTextContent').value.trim(),m=document.getElementById('editTextMsg');if(!ti||!co){m.textContent=wt('msg_title_content_needed');return;}let r;if(id)r=await api('/api/texts/'+id,'PUT',{title:ti,content:co,language:la});else r=await api('/api/texts','POST',{title:ti,content:co,language:la});if(r?.ok){m.className='modal-msg success';m.textContent=wt('msg_save_done');await loadTexts();refreshAdminTextList();setTimeout(()=>closeModal('editTextModal'),600);}else{m.className='modal-msg';m.textContent=r?.msg||wt('msg_fail');}}
async function doDeleteText(){const id=document.getElementById('editTextId').value;if(!id)return;if(!confirm(wt('msg_confirm_delete')))return;const r=await api('/api/texts/'+id,'DELETE');if(r?.ok){closeModal('editTextModal');await loadTexts();refreshAdminTextList();}}
async function doDeleteTextDirect(id,title){if(!confirm('"'+title+'"  â€” '+wt('msg_confirm_delete')))return;const r=await api('/api/texts/'+id,'DELETE');if(r?.ok){await loadTexts();refreshAdminTextList();}}

/* Pause */
function doPause(manual=false,silent=false){if(!started||paused)return;paused=true;manualPause=manual;pauseStartTime=Date.now();if(!silent){document.getElementById('pauseOverlay').classList.add('active');}document.getElementById('pauseStatus').style.display='';}
function doResume(){if(!paused)return;paused=false;manualPause=false;if(pauseStartTime){totalPausedMs+=(Date.now()-pauseStartTime);pauseStartTime=null;}document.getElementById('pauseOverlay').classList.remove('active');document.getElementById('pauseStatus').style.display='none';if(lineInputs[currentLineIdx])lineInputs[currentLineIdx].focus();}

/* Line split + FIX#1 reflow */
function splitTextToLines(content){
  rawParagraphs=content.split('\n').filter(l=>l.length>0).map(l=>stripLeadingBlanks(l)).filter(l=>l.length>0);
  if(rawParagraphs.length===0)rawParagraphs=[stripLeadingBlanks(content)];
  if(unitMode==='paragraph')return [...rawParagraphs];
  return reflowLines();
}
function reflowLines(){
  const m=document.createElement('div');
  m.style.cssText='position:absolute;visibility:hidden;white-space:nowrap;font-family:var(--pf);font-size:var(--pfs);letter-spacing:var(--pls);padding:0 14px;';
  document.body.appendChild(m);
  const maxW=(document.getElementById('linePracticeArea').clientWidth||900)-32;
  const result=[];
  for(const r of rawParagraphs){if(!r)continue;let ln='';for(let i=0;i<r.length;i++){const t=ln+r[i];m.textContent=t;if(m.offsetWidth>maxW&&ln.length>0){result.push(ln);ln=r[i];}else{ln=t;}}if(ln)result.push(ln);}
  document.body.removeChild(m);
  return result.length>0?result:[''];
}

/* FIX#1: Window resize â†’ reflow lines, preserve typed text + stats */
let _resizeTimer=null;
window.addEventListener('resize',()=>{
  if(!practicing||!currentText||unitMode!=='line'||lines.length===0)return;
  clearTimeout(_resizeTimer);
  _resizeTimer=setTimeout(doReflow,200);
});
function doReflow(){
  if(!practicing||!currentText||unitMode!=='line')return;
  const allTyped=lineInputs.map(inp=>inp.value).join('');
  const newLines=reflowLines();
  if(newLines.length===lines.length&&newLines.every((l,i)=>l===lines[i]))return; /* truly no change */
  lines=newLines;
  /* redistribute typed text across new lines */
  const typedPerLine=[];let pos=0;
  for(const ln of lines){typedPerLine.push(allTyped.slice(pos,pos+ln.length));pos+=ln.length;}
  buildLineUI();
  /* restore typed, highlights, completed */
  for(let i=0;i<lines.length;i++){
    if(typedPerLine[i]){
      lineInputs[i].value=typedPerLine[i];
      refreshHighlights(i,typedPerLine[i],lines[i],lineDisplays[i].children);
      if(normalizeFullwidth(typedPerLine[i])===normalizeFullwidth(lines[i])&&typedPerLine[i].length===lines[i].length)
        lineBlocks[i].classList.add('completed');
    }
  }
  /* find correct current line */
  let newCur=0;
  for(let i=0;i<lines.length;i++){
    if(lineInputs[i].value.length<lines[i].length&&!lineBlocks[i].classList.contains('completed')){newCur=i;break;}
    if(i===lines.length-1)newCur=i;
  }
  activateLine(newCur);
  if(started&&!paused)lineInputs[newCur].focus();
}

/* Practice */
function startPractice(){const s=document.getElementById('textSelect'),id=parseInt(s.value);if(!id){alert(wt('msg_select_text'));return;}currentText=texts.find(t=>t.id===id);if(!currentText)return;fullReset();const _sb=document.querySelector('.btn-stop');_sb.textContent=wt('btn_stop_f12');_sb.dataset.state='stop';practicing=true;started=false;paused=false;keystrokes=0;startTime=null;totalPausedMs=0;
document.getElementById('practiceArea').style.display='';document.getElementById('practiceMsg').style.display='none';document.getElementById('statsBar').style.display='';
lines=splitTextToLines(currentText.content);currentLineIdx=0;buildLineUI();
document.getElementById('prepArea').style.display='';const pr=document.getElementById('prepInput');pr.value='';pr.focus();}

/* FIX#6: buildLineUI â€” NO disabled; class-based active/inactive; single active line */
function buildLineUI(){const area=document.getElementById('linePracticeArea');area.innerHTML='';lineInputs=[];lineDisplays=[];lineBlocks=[];
lines.forEach((line,idx)=>{const block=document.createElement('div');block.className='line-block';const origDiv=document.createElement('div');origDiv.className='line-original';for(let i=0;i<line.length;i++){const sp=document.createElement('span');sp.className='ch'+(idx===0&&i===0?' current':'');sp.textContent=line[i];origDiv.appendChild(sp);}
const inp=document.createElement('input');inp.type='text';inp.className='line-input'+(idx===0?' active-line':' inactive-line');inp.autocomplete='off';inp.spellcheck=false;
block.appendChild(origDiv);block.appendChild(inp);area.appendChild(block);lineInputs.push(inp);lineDisplays.push(origDiv);lineBlocks.push(block);
inp.addEventListener('compositionstart',()=>{inp._composing=true;});
inp.addEventListener('compositionend',()=>{inp._composing=false;handleLineInput(idx);});
inp.addEventListener('input',()=>{if(!inp._composing)handleLineInput(idx);});
inp.addEventListener('keydown',e=>handleLineKeydown(e,idx));
/* FIX#6: click on input â†’ switch to this line */
inp.addEventListener('mousedown',e=>{if(!practicing)return;if(paused){e.preventDefault();doResume();return;}if(idx!==currentLineIdx){e.preventDefault();switchToLine(idx);}});
/* FIX#6: click on original text area â†’ also switch */
origDiv.addEventListener('mousedown',e=>{if(!practicing)return;e.preventDefault();if(paused){doResume();return;}if(idx!==currentLineIdx)switchToLine(idx);else inp.focus();});
});}

/* FIX#6: activate exactly one line, deactivate all others */
function activateLine(idx){
  lineInputs.forEach(inp=>{inp.classList.remove('active-line');inp.classList.add('inactive-line');});
  currentLineIdx=idx;
  lineInputs[idx].classList.add('active-line');lineInputs[idx].classList.remove('inactive-line');
}
function switchToLine(toIdx){if(toIdx<0||toIdx>=lineInputs.length||toIdx===currentLineIdx)return;activateLine(toIdx);lineInputs[toIdx].focus();updateCursorDisplay(toIdx);}
function updateCursorDisplay(idx){const spans=lineDisplays[idx].children,typed=lineInputs[idx].value;for(let i=0;i<spans.length;i++){spans[i].classList.remove('current');if(i===typed.length)spans[i].classList.add('current');}}

document.getElementById('prepInput').addEventListener('keydown',e=>{
  if(e.key==='Enter'||e.key==='ArrowDown'){e.preventDefault();if(!practicing)return;started=true;document.querySelector('.btn-stop').disabled=false;startTime=Date.now();timerInterval=setInterval(updateStats,200);document.getElementById('prepArea').style.display='none';if(lineInputs[0])lineInputs[0].focus();}
});

function handleLineKeydown(e,idx){if(!practicing)return;
/* FIX#6: typing in non-active line â†’ switch first */
if(idx!==currentLineIdx&&e.key!=='Escape'){e.preventDefault();switchToLine(idx);return;}
if(e.key==='Escape'){e.preventDefault();e.stopPropagation();if(paused)doResume();else doPause(true);return;}
if(paused){const ig=['Shift','Control','Alt','Meta','CapsLock','NumLock','ScrollLock'];if(!ig.includes(e.key)){e.preventDefault();doResume();}return;}
if(!started&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&!['F11','F12','Escape','Shift','Control','Alt','Meta'].includes(e.key)){started=true;document.querySelector('.btn-stop').disabled=false;startTime=Date.now();timerInterval=setInterval(updateStats,200);document.getElementById('prepArea').style.display='none';}
if((e.key===' '||e.code==='Space')&&lineInputs[idx].value.length===0){e.preventDefault();return;}
if(e.key.length===1||e.key==='Backspace'||e.key==='Enter'||e.key==='Process'||e.keyCode===229){keystrokes++;playSfx();}
if(e.key==='Tab'&&!e.shiftKey){e.preventDefault();keystrokes++;if(idx<lines.length-1)moveToLine(idx+1,idx);return;}
if(e.key==='Tab'&&e.shiftKey){e.preventDefault();keystrokes++;if(idx>0)moveToLine(idx-1,idx);return;}
if(e.key==='ArrowUp'){e.preventDefault();if(idx>0)switchToLine(idx-1);return;}
if(e.key==='ArrowDown'){e.preventDefault();if(idx<lines.length-1)switchToLine(idx+1);return;}
if(e.key==='Backspace'&&lineInputs[idx].selectionStart===0&&lineInputs[idx].selectionEnd===0){if(idx>0){e.preventDefault();moveToLine(idx-1,idx);return;}}
if(e.key==='Enter'){e.preventDefault();if(idx<lines.length-1)moveToLine(idx+1,idx,true);else stopPractice();return;}}

function moveToLine(toIdx,fromIdx,markComplete=false){if(markComplete)lineBlocks[fromIdx].classList.add('completed');activateLine(toIdx);lineInputs[toIdx].focus();updateCursorDisplay(toIdx);lineBlocks[toIdx].scrollIntoView({behavior:'smooth',block:'center'});}

function handleLineInput(idx){if(!practicing||paused)return;
/* FIX#6: ignore input in non-active line */
if(idx!==currentLineIdx){lineInputs[idx].value='';return;}
const inp=lineInputs[idx];if(inp._composing)return;let typed=inp.value;
if(typed.length>0&&/^[\s\u3000\u00A0]/.test(typed)){typed=stripLeadingBlanks(typed);inp.value=typed;}
const target=lines[idx],spans=lineDisplays[idx].children;
if(typed.length>target.length){const overflow=typed.slice(target.length);inp.value=typed.slice(0,target.length);typed=inp.value;refreshHighlights(idx,typed,target,spans);updateStats();if(idx<lines.length-1){lineBlocks[idx].classList.add('completed');moveToLine(idx+1,idx,false);const next=overflow.replace(/^ /,'');if(next){lineInputs[idx+1].value=next;handleLineInput(idx+1);}}else{stopPractice();}return;}
refreshHighlights(idx,typed,target,spans);updateStats();
if(typed.length>0){const tN=normalizeFullwidth(typed),gN=normalizeFullwidth(target);if(tN===gN&&idx<lines.length-1){lineBlocks[idx].classList.add('completed');moveToLine(idx+1,idx,false);}}}

function refreshHighlights(idx,typed,target,spans){for(let i=0;i<target.length;i++){const sp=spans[i];if(!sp)continue;sp.className='ch';if(i<typed.length){const tn=normalizeFullwidth(target[i]),un=normalizeFullwidth(typed[i]);if(un===tn)sp.className='ch correct';else sp.className=target[i]===' '?'ch space-incorrect':'ch incorrect';}else if(i===typed.length){sp.className='ch current';}}}

function doReset(){
  if(!practicing&&lines.length===0){fullReset();return;}
  if(!practicing&&lines.length>0){startPractice();return;}
  started=false;paused=false;manualPause=false;startTime=null;totalPausedMs=0;pauseStartTime=null;
  if(timerInterval){clearInterval(timerInterval);timerInterval=null;}
  keystrokes=0;currentLineIdx=0;
  lineInputs.forEach(inp=>{inp.value='';inp.classList.remove('active-line');inp.classList.add('inactive-line');});
  lineBlocks.forEach(b=>b.classList.remove('completed'));
  lineDisplays.forEach((d,i)=>{const spans=d.children;for(let j=0;j<spans.length;j++){spans[j].className='ch';if(i===0&&j===0)spans[j].className='ch current';}});
  lineInputs[0].classList.add('active-line');lineInputs[0].classList.remove('inactive-line');
  document.getElementById('statTime').textContent='0:00';document.getElementById('statCpm').textContent='0';document.getElementById('statKpm').textContent='0';document.getElementById('statAcc').textContent='0%';document.getElementById('statProgress').textContent='0%';document.getElementById('statChars').textContent='0';document.getElementById('statKeys').textContent='0';
  document.getElementById('pauseOverlay').classList.remove('active');document.getElementById('pauseStatus').style.display='none';
  document.getElementById('prepArea').style.display='';document.getElementById('prepInput').value='';document.getElementById('prepInput').focus();
}
function fullReset(){practicing=false;started=false;paused=false;manualPause=false;startTime=null;totalPausedMs=0;pauseStartTime=null;if(timerInterval){clearInterval(timerInterval);timerInterval=null;}keystrokes=0;currentLineIdx=0;lines=[];lineInputs=[];lineDisplays=[];lineBlocks=[];rawParagraphs=[];document.getElementById('linePracticeArea').innerHTML='';document.getElementById('statTime').textContent='0:00';document.getElementById('statCpm').textContent='0';document.getElementById('statKpm').textContent='0';document.getElementById('statAcc').textContent='0%';document.getElementById('statProgress').textContent='0%';document.getElementById('statChars').textContent='0';document.getElementById('statKeys').textContent='0';document.getElementById('pauseOverlay').classList.remove('active');document.getElementById('pauseStatus').style.display='none';const _srb=document.querySelector('.btn-stop');_srb.disabled=true;_srb.textContent=wt('btn_stop_f12');_srb.dataset.state='stop';}

function stopPractice(){if(!practicing)return;practicing=false;started=false;if(paused&&pauseStartTime){totalPausedMs+=(Date.now()-pauseStartTime);pauseStartTime=null;}paused=false;if(timerInterval){clearInterval(timerInterval);timerInterval=null;}lineInputs.forEach(i=>{i.classList.remove('active-line');i.classList.add('inactive-line');});document.getElementById('pauseOverlay').classList.remove('active');document.getElementById('pauseStatus').style.display='none';const _spb=document.querySelector('.btn-stop');_spb.textContent=wt('btn_result_f12');_spb.dataset.state='result';showResults();}

function getElapsed(){if(!startTime)return 0;let pe=totalPausedMs;if(paused&&pauseStartTime)pe+=(Date.now()-pauseStartTime);return Math.max(0,(Date.now()-startTime-pe))/1000;}
function updateStats(){const el=getElapsed(),mn=Math.floor(el/60),sc=Math.floor(el%60);document.getElementById('statTime').textContent=mn+':'+String(sc).padStart(2,'0');if(el<=0)return;let tc=0,tco=0,ttl=0;for(let i=0;i<lines.length;i++){const ty=lineInputs[i]?normalizeFullwidth(lineInputs[i].value):'',tg=normalizeFullwidth(lines[i]),cm=Math.min(ty.length,tg.length);for(let j=0;j<cm;j++)if(ty[j]===tg[j])tc++;tco+=cm;ttl+=(lineInputs[i]?lineInputs[i].value.length:0);}const ttg=lines.reduce((s,l)=>s+l.length,0);document.getElementById('statCpm').textContent=Math.round(tc/(el/60));document.getElementById('statKpm').textContent=Math.round(keystrokes/(el/60));document.getElementById('statAcc').textContent=(tco>0?Math.round(tc/tco*100):0)+'%';document.getElementById('statProgress').textContent=Math.min(ttg>0?Math.round(ttl/ttg*100):0,100)+'%';document.getElementById('statChars').textContent=ttl;document.getElementById('statKeys').textContent=keystrokes;}

/* Focus pause/resume */
document.addEventListener('focusin',e=>{if(!practicing||!started)return;if(paused&&!manualPause&&lineInputs.includes(e.target))doResume();});
document.addEventListener('focusout',e=>{if(!practicing||!started||paused)return;setTimeout(()=>{if(!practicing||!started||paused)return;const a=document.activeElement;if(lineInputs.includes(a)||a===document.getElementById('prepInput'))return;const activeTab=document.querySelector('.tab-btn.active')?.dataset.tab;if(activeTab!=='practice')return;if(a===document.body||a.classList.contains('scroll-btn'))return;doPause(false);},200);});
document.getElementById('pauseOverlay').addEventListener('click',()=>{if(paused)doResume();});

/* Results */
function showResults(){const el=getElapsed();let tc=0,tco=0,ttl=0;for(let i=0;i<lines.length;i++){const ty=lineInputs[i]?normalizeFullwidth(lineInputs[i].value):'',tg=normalizeFullwidth(lines[i]),cm=Math.min(ty.length,tg.length);for(let j=0;j<cm;j++)if(ty[j]===tg[j])tc++;tco+=cm;ttl+=(lineInputs[i]?lineInputs[i].value.length:0);}const ttg=lines.reduce((s,l)=>s+l.length,0);
const cpm=el>0?Math.round(tc/(el/60)):0,kpm=el>0?Math.round(keystrokes/(el/60)):0,acc=tco>0?Math.round(tc/tco*1000)/10:0,prog=ttg>0?Math.round(ttl/ttg*1000)/10:0;
document.getElementById('resCpm').textContent=cpm;document.getElementById('resKpm').textContent=kpm;document.getElementById('resAcc').textContent=acc+'%';document.getElementById('resProgress').textContent=Math.min(prog,100)+'%';document.getElementById('resTime').textContent=el.toFixed(1)+wt('unit_sec');document.getElementById('resChars').textContent=ttl;
window._lastResult={cpm,kpm,acc,progress:Math.min(prog,100),elapsed:el,chars:ttl,input_chars:ttl};document.getElementById('rankSubmitMsg').textContent='';if(currentUser)document.getElementById('rankSubmitArea').style.display='';openModal('resultsModal');}
async function submitRanking(){if(!currentUser||!window._lastResult||!currentText)return;const tw=document.getElementById('resTypewriter').value.trim();if(!tw){document.getElementById('rankSubmitMsg').textContent=wt('msg_enter_typewriter');return;}const bk=await sha1(currentText.content);const r=await api('/api/rankings','POST',{board_key:bk,board_name:currentText.title,typewriter:tw,cpm:window._lastResult.cpm,kpm:window._lastResult.kpm,acc:window._lastResult.acc,completion:window._lastResult.progress,chars:window._lastResult.chars,input_chars:window._lastResult.input_chars,elapsed:window._lastResult.elapsed,created_at:new Date().toLocaleString('sv-SE').replace('T',' '),created_ts:Math.floor(Date.now()/1000)});const m=document.getElementById('rankSubmitMsg');if(r?.ok){m.className='modal-msg success';m.textContent=wt('msg_rank_done');}else{m.className='modal-msg';m.textContent=r?.msg||wt('msg_fail');}}
async function sha1(t){const d=new TextEncoder().encode(t),h=await crypto.subtle.digest('SHA-1',d);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('');}

/* Rankings */
let _rankAllData=[];
async function loadRankings(){const r=await api('/api/rankings');if(!r?.ok)return;const s=document.getElementById('rankBoardSelect'),cv=s.value;s.innerHTML='<option value="">'+wt('all')+'</option>';const meta=r.meta||{};for(const[k,m]of Object.entries(meta)){const o=document.createElement('option');o.value=k;o.textContent=m.name||k;s.appendChild(o);}s.value=cv;const fb=s.value;let all=[];for(const[bk,rows]of Object.entries(r.boards||{})){if(fb&&bk!==fb)continue;const bn=meta[bk]?.name||bk;for(const row of rows)all.push({...row,_boardName:bn,_boardKey:bk});}all.sort((a,b)=>b.cpm-a.cpm||b.created_ts-a.created_ts);_rankAllData=all;const adm=isAdmin();const cols=adm?11:10;const tb=document.getElementById('rankBody');if(all.length===0){tb.innerHTML='<tr><td colspan="'+cols+'" style="text-align:center;padding:30px;color:#94a3b8">'+wt('no_data')+'</td></tr>';return;}tb.innerHTML=all.slice(0,100).map((r,i)=>'<tr>'+(adm?'<td style="text-align:center;padding:4px"><input type="checkbox" class="rank-chk" data-idx="'+i+'" data-id="'+(r.id||'')+'" onchange="rankAdminUpdateCount()"></td>':'')+'<td class="rank-num">'+(i+1)+'</td><td class="rank-left">'+esc(r.nickname)+'</td><td class="rank-left">'+esc(r.typewriter)+'</td><td class="rank-left">'+esc(r._boardName)+'</td><td><strong>'+r.cpm+'</strong></td><td>'+r.kpm+'</td><td>'+(typeof r.acc==='number'?Math.round(r.acc):r.acc)+'%</td><td>'+(typeof r.completion==='number'?Math.round(r.completion):r.completion)+'%</td><td>'+(r.input_chars||0)+'</td><td class="rank-date">'+esc(r.created_at||'')+'</td></tr>').join('');const th=document.querySelector('.ranking-table thead tr');if(adm&&!th.querySelector('.rank-chk-th')){const chTh=document.createElement('th');chTh.className='rank-chk-th';chTh.style.cssText='min-width:36px;width:36px';chTh.textContent='âœ“';th.insertBefore(chTh,th.firstChild);}else if(!adm){const ex=th.querySelector('.rank-chk-th');if(ex)ex.remove();}}
document.getElementById('rankBoardSelect').addEventListener('change',loadRankings);
function rankAdminSelectAll(on){document.querySelectorAll('.rank-chk').forEach(c=>c.checked=on);rankAdminUpdateCount();}
function rankAdminUpdateCount(){const n=document.querySelectorAll('.rank-chk:checked').length;document.getElementById('rankAdminSelCount').textContent=n>0?n+wt('n_selected'):'';}
async function rankAdminDeleteSelected(){if(!isAdmin())return;const chks=[...document.querySelectorAll('.rank-chk:checked')];if(chks.length===0){alert(wt('msg_no_sel_rank'));return;}if(!confirm(chks.length+wt('msg_confirm_del_ranks')))return;let ok=0;for(const c of chks){const id=c.dataset.id;if(!id)continue;const r=await api('/api/rankings/'+id,'DELETE');if(r?.ok)ok++;}alert(ok+wt('msg_del_rank_done'));loadRankings();}
async function rankAdminDeleteBoard(){if(!isAdmin())return;const bk=document.getElementById('rankBoardSelect').value;if(!bk){alert(wt('msg_select_board'));return;}const bn=document.getElementById('rankBoardSelect').selectedOptions[0]?.textContent||bk;if(!confirm('"'+bn+'" '+wt('msg_confirm_del_board')))return;const r=await api('/api/rankings/board/'+encodeURIComponent(bk),'DELETE');if(r?.ok){alert(wt('msg_del_done'));loadRankings();}else{alert(r?.msg||wt('msg_fail'));}}
function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML;}

/* Global hotkeys */
document.addEventListener('keydown',e=>{
  if(document.querySelector('.modal-overlay.active:not(#pauseOverlay)')){return;}
  if(e.key==='Escape'&&practicing&&started){e.preventDefault();if(paused)doResume();else doPause(true);return;}
  if(paused&&practicing&&started){const ig=['Shift','Control','Alt','Meta','CapsLock','NumLock','ScrollLock','F1','F2','F3','F4','F5','F6','F7','F8','F9'];if(!ig.includes(e.key)&&e.key!=='Escape'){e.preventDefault();doResume();return;}}
  if(e.key==='F11'){e.preventDefault();doReset();}if(e.key==='F12'){e.preventDefault();if(document.querySelector('.btn-stop').disabled)return;if(practicing){stopPractice();}else if(document.querySelector('.btn-stop').dataset.state==='result'){openModal('resultsModal');}}});

/* Init */
(async function init(){loadSettings();_wlang=localStorage.getItem('ui_lang')||'ko';document.getElementById('settingUILang').value=_wlang;applyWebLang();preloadAllSfx();try{const c=JSON.parse(localStorage.getItem('cachedTexts'));if(c?.texts?.length>0)populateTextSelect(c.texts,c.languages||[]);}catch(e){}try{const s=JSON.parse(localStorage.getItem('auth'));if(s?.token)currentUser=s;}catch(e){}updateAuthUI();const tp=loadTexts(),rp=loadRankings();if(currentUser){api('/api/rankings').then(r=>{if(!r){currentUser=null;localStorage.removeItem('auth');updateAuthUI();}});checkNotifications();}await Promise.all([tp,rp]);})();
</script>
</body>
</html>
